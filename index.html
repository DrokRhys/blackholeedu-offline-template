<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ČERNÉ DÍRY</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Space+Mono:wght@400;700&family=Crimson+Pro:ital,wght@0,300;0,400;1,300&display=swap" rel="stylesheet">
<style>
:root {
  --void: #03020a;
  --accent: #ff6b35;
  --plasma: #c44bff;
  --star: #e8d5a3;
  --cold: #5bb4ff;
  --text: #d4cfc8;
  --dim: #6b6580;
  --accent-rgb: 255, 107, 53;
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  background: var(--void);
  color: var(--text);
  font-family: 'Crimson Pro', serif;
  overflow-x: hidden;
  overflow-y: auto;
  width: 100vw;
  min-height: 100vh;
  height: auto;
  cursor: none;
}
.cursor {
  position: fixed;
  width: 8px; height: 8px;
  background: var(--accent);
  border-radius: 50%;
  pointer-events: none;
  z-index: 9999;
  transform: translate(-50%,-50%);
  mix-blend-mode: difference;
}
.cursor-ring {
  position: fixed;
  width: 32px; height: 32px;
  border: 1px solid rgba(var(--accent-rgb), 0.45);
  border-radius: 50%;
  pointer-events: none;
  z-index: 9998;
  transform: translate(-50%,-50%);
  transition: all 0.15s ease;
}
#starfield {
  position: fixed; top:0; left:0;
  width:100%; height:100%; z-index:0;
}
.presentation {
  position: relative; z-index:10;
  width:100vw; height:100vh;
  display:flex; flex-direction:column;
}
.slides-wrapper {
  flex:1; position:relative; overflow:hidden;
}
.slide {
  position:absolute; inset:0;
  display:flex; align-items:center; justify-content:center;
  padding:60px; opacity:0; pointer-events:none;
}
.slide.active { opacity:1; pointer-events:all; }
.slide.enter-right { animation: inRight 0.7s cubic-bezier(0.16,1,0.3,1) forwards; }
.slide.exit-left { animation: outLeft 0.7s cubic-bezier(0.16,1,0.3,1) forwards; }
.slide.enter-left { animation: inLeft 0.7s cubic-bezier(0.16,1,0.3,1) forwards; }
.slide.exit-right { animation: outRight 0.7s cubic-bezier(0.16,1,0.3,1) forwards; }
@keyframes inRight { from{opacity:0;transform:translateX(80px) scale(0.97)} to{opacity:1;transform:none} }
@keyframes outLeft { from{opacity:1;transform:none} to{opacity:0;transform:translateX(-80px) scale(0.97)} }
@keyframes inLeft { from{opacity:0;transform:translateX(-80px) scale(0.97)} to{opacity:1;transform:none} }
@keyframes outRight { from{opacity:1;transform:none} to{opacity:0;transform:translateX(80px) scale(0.97)} }
@keyframes fadeUp { from{opacity:0;transform:translateY(24px)} to{opacity:1;transform:none} }
@keyframes fadeIn { from{opacity:0} to{opacity:1} }
@keyframes rotate { from{transform:rotate(0deg)} to{transform:rotate(360deg)} }
@keyframes pulse { 0%,100%{opacity:.6;transform:scale(1)} 50%{opacity:1;transform:scale(1.05)} }
@keyframes clockTick { from{transform:rotate(0deg)} to{transform:rotate(360deg)} }

.nav-bar {
  position:fixed; bottom:0; left:0; right:0; z-index:100;
  display:flex; align-items:center; justify-content:space-between;
  padding:20px 60px;
  background: linear-gradient(to top, rgba(3,2,10,0.95), transparent);
}
.nav-dots { display:flex; gap:10px; align-items:center; }
.nav-dot {
  width:6px; height:6px; border-radius:50%;
  background:var(--dim); cursor:pointer; transition:all .3s;
}
.nav-dot.active { background:var(--accent); width:24px; border-radius:3px; }
.nav-btn {
  background:none; border:1px solid rgba(255,255,255,.12); color:var(--text);
  font-family:'Space Mono',monospace; font-size:11px; padding:10px 20px;
  cursor:pointer; letter-spacing:.1em; text-transform:uppercase; transition:all .3s;
}
.nav-btn:hover { border-color:var(--accent); color:var(--accent); }
.slide-counter { font-family:'Space Mono',monospace; font-size:11px; color:var(--dim); letter-spacing:.15em; }

/* Label */
.slide-label {
  font-family:'Space Mono',monospace; font-size:10px; letter-spacing:.3em;
  color:var(--accent); text-transform:uppercase; margin-bottom:20px;
  display:flex; align-items:center; gap:12px;
}
.slide-label::before { content:''; width:32px; height:1px; background:var(--accent); }
.slide-heading {
  font-family:'Bebas Neue',sans-serif;
  font-size:clamp(48px,6vw,80px); line-height:1; color:white; margin-bottom:28px;
}
.slide-body { font-size:18px; line-height:1.7; color:var(--text); font-weight:300; max-width:540px; }
.slide-body strong { color:var(--star); font-weight:400; }

/* SLIDE 1 HERO */
.s-hero { flex-direction:column; text-align:center; }
.hero-eyebrow {
  font-family:'Space Mono',monospace; font-size:11px; letter-spacing:.3em;
  color:var(--accent); text-transform:uppercase; margin-bottom:32px;
  animation:fadeUp 1s .2s both;
}
.hero-title {
  font-family:'Bebas Neue',sans-serif;
  font-size:clamp(80px,12vw,160px); line-height:.9; color:white;
  animation:fadeUp 1s .4s both;
}
.hero-title .outline { color:transparent; -webkit-text-stroke:1px var(--accent); }
.hero-sub {
  font-size:20px; font-weight:300; font-style:italic; color:var(--dim);
  margin-top:24px; animation:fadeUp 1s .6s both; letter-spacing:.05em;
}
.hero-bh-wrap {
  position:absolute; top:50%; left:50%;
  transform:translate(-50%,-58%);
  pointer-events:none; animation:fadeIn 2s .8s both;
  z-index:-1;
}

/* SLIDE 2 DEFINITION */
.s-def {
  gap:80px;
  align-items:center;
  width:min(1180px,100%);
  margin:0 auto;
}
.def-visual { flex:0 0 360px; height:360px; }
.fact-box {
  margin-top:28px; padding:18px 22px;
  border-left:2px solid var(--accent);
  background:rgba(255,107,53,.05);
}
.fact-label { font-family:'Space Mono',monospace; font-size:10px; color:var(--accent); letter-spacing:.2em; margin-bottom:6px; }
.fact-text { font-size:14px; color:var(--dim); font-style:italic; }

/* SLIDE 3 ANATOMY */
.s-anat {
  gap:60px;
  width:min(1240px,100%);
  margin:0 auto;
}
.anat-diagram { flex:0 0 400px; height:420px; }
.anat-content { flex:1; display:flex; flex-direction:column; max-width:760px; }
.anat-item {
  display:flex; gap:16px; padding:18px 0;
  border-bottom:1px solid rgba(255,255,255,.06);
  opacity:0; transform:translateX(20px); transition:all .5s;
}
.anat-item.vis { opacity:1; transform:none; }
.anat-num { font-family:'Bebas Neue',sans-serif; font-size:34px; color:var(--accent); opacity:.4; line-height:1; width:38px; flex-shrink:0; }
.anat-info h4 { font-family:'Space Mono',monospace; font-size:11px; letter-spacing:.15em; color:var(--cold); margin-bottom:5px; text-transform:uppercase; }
.anat-info p { font-size:14px; color:var(--dim); line-height:1.5; }

/* SLIDE 4 TYPES */
.s-types {
  flex-direction:column;
  gap:40px;
  align-items:center;
  justify-content:center;
  padding:60px 80px;
  width:min(1460px,100%);
  margin:0 auto;
}
.types-hdr { display:flex; align-items:flex-end; justify-content:space-between; width:100%; }
.types-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:2px; width:100%; max-width:1400px; flex:1; margin:0 auto; }
.type-card {
  background:rgba(255,255,255,.02); border:1px solid rgba(255,255,255,.06);
  padding:32px 28px; position:relative; overflow:hidden; transition:all .4s;
}
.type-card::before {
  content:''; position:absolute; bottom:0; left:0; right:0; height:2px;
  background:var(--cc,var(--accent)); transform:scaleX(0); transform-origin:left; transition:transform .4s;
}
.type-card:hover::before { transform:scaleX(1); }
.type-card:hover { background:rgba(255,255,255,.04); }
.type-mass { font-family:'Bebas Neue',sans-serif; font-size:44px; color:var(--cc,var(--accent)); line-height:1; margin-bottom:6px; }
.type-unit { font-family:'Space Mono',monospace; font-size:12px; color:var(--dim); margin-bottom:12px; }
.type-name { font-family:'Space Mono',monospace; font-size:20px; letter-spacing:.12em; color:white; text-transform:uppercase; margin-bottom:16px; }
.type-desc { font-size:17px; color:var(--dim); line-height:1.6; }
.type-ex { margin-top:16px; font-family:'Space Mono',monospace; font-size:14px; color:var(--cc,var(--accent)); letter-spacing:.07em; }

/* SLIDE 5 SPAGHETTI */
.s-spag {
  gap:80px;
  align-items:center;
  width:min(1180px,100%);
  margin:0 auto;
}
.spag-vis { flex:0 0 320px; height:400px; }
.big-stat { font-family:'Bebas Neue',sans-serif; font-size:90px; line-height:1; color:var(--plasma); margin:20px 0 6px; }
.big-stat-lbl { font-family:'Space Mono',monospace; font-size:10px; letter-spacing:.2em; color:var(--dim); text-transform:uppercase; }

/* SLIDE 6 TIME */
.s-time {
  gap:80px;
  align-items:center;
  width:min(1180px,100%);
  margin:0 auto;
}
.time-vis { flex:0 0 400px; height:420px; }
.quote-block {
  margin-top:36px; padding:24px 28px;
  border:1px solid rgba(91,180,255,.2);
  background:rgba(91,180,255,.03); position:relative;
}
.quote-block::before {
  content:'"'; font-family:'Bebas Neue',sans-serif; font-size:100px;
  color:rgba(91,180,255,.1); position:absolute; top:-15px; left:12px; line-height:1;
}
.quote-text { font-size:16px; font-style:italic; color:var(--cold); line-height:1.7; position:relative; z-index:1; }
.quote-src { margin-top:10px; font-family:'Space Mono',monospace; font-size:10px; color:var(--dim); letter-spacing:.12em; }

/* SLIDE 7 HAWKING */
.s-hawk {
  flex-direction:column;
  gap:36px;
  align-items:center;
  text-align:center;
  padding:50px 80px;
  width:min(1100px,100%);
  margin:0 auto;
}
.s-hawk > * {
  margin-left:auto;
  margin-right:auto;
}
.hawk-eq {
  font-family:'Space Mono',monospace; font-size:clamp(15px,2vw,24px);
  color:var(--star); letter-spacing:.05em; padding:22px 44px;
  border:1px solid rgba(232,213,163,.2); background:rgba(232,213,163,.03); line-height:1.8;
}
.hawk-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:28px; width:100%; max-width:860px; }
.hawk-item { text-align:left; }
.hawk-icon { font-size:26px; margin-bottom:10px; }
.hawk-item h4 { font-family:'Space Mono',monospace; font-size:10px; letter-spacing:.15em; color:var(--star); text-transform:uppercase; margin-bottom:6px; }
.hawk-item p { font-size:13px; color:var(--dim); line-height:1.6; }

/* SLIDE 8 FINALE */
.s-finale { flex-direction:column; text-align:center; gap:28px; align-items:center; }
.finale-bg-num {
  font-family:'Bebas Neue',sans-serif; font-size:200px; line-height:1;
  color:transparent; -webkit-text-stroke:1px rgba(255,255,255,.05);
  position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
  user-select:none; pointer-events:none;
}
.finale-inner { position:relative; z-index:1; }
.finale-tag { font-family:'Space Mono',monospace; font-size:11px; letter-spacing:.3em; color:var(--accent); text-transform:uppercase; margin-bottom:20px; }
.finale-h { font-family:'Bebas Neue',sans-serif; font-size:clamp(56px,8vw,110px); line-height:.95; color:white; margin-bottom:24px; }
.finale-body { font-size:18px; font-style:italic; color:var(--dim); max-width:540px; line-height:1.7; margin:0 auto; }

.music-controls {
  position: static;
  width: min(92vw, 520px);
  border: 1px solid rgba(var(--accent-rgb), 0.45);
  background: rgba(3, 2, 10, 0.82);
  border-radius: 6px;
  padding: 8px 10px;
  backdrop-filter: blur(6px);
  box-sizing: border-box;
}
.music-row {
  display: grid;
  grid-template-columns: auto auto auto auto minmax(90px,1fr) minmax(64px,.8fr);
  align-items: center;
  column-gap: 8px;
}
.music-btn {
  border: 1px solid rgba(255,255,255,.18);
  background: rgba(255,255,255,.03);
  color: var(--text);
  font-family: 'Space Mono', monospace;
  font-size: 11px;
  letter-spacing: .08em;
  padding: 5px 8px;
  cursor: pointer;
  border-radius: 4px;
}
.music-btn:hover {
  color: var(--accent);
  border-color: var(--accent);
}
.music-play {
  width: 72px;
}
.music-track {
  font-family: 'Space Mono', monospace;
  font-size: 8px;
  color: var(--dim);
  letter-spacing: .11em;
  text-transform: uppercase;
  text-align: left;
  width: 76px;
  white-space: nowrap;
}
.music-seek {
  width: 100%;
  min-width: 90px;
  accent-color: #ff6b35;
}
.music-volume {
  width: 100%;
  min-width: 64px;
  margin-left: 0;
  accent-color: #ff6b35;
}
.back-home-link {
  position: fixed;
  top: 18px;
  left: 18px;
  z-index: 121;
  border: 1px solid rgba(255,255,255,.18);
  background: rgba(3,2,10,0.72);
  color: var(--text);
  font-family:'Space Mono',monospace;
  font-size: 11px;
  letter-spacing: .1em;
  text-transform: uppercase;
  padding: 10px 13px;
  text-decoration: none;
  border-radius: 6px;
  backdrop-filter: blur(6px);
  transition: all .2s ease;
}
.back-home-link:hover {
  color: var(--accent);
  border-color: var(--accent);
}
.lang-switch {
  position: fixed;
  top: 18px;
  left: 190px;
  z-index: 121;
  display: inline-flex;
  border: 1px solid rgba(255,255,255,.18);
  border-radius: 6px;
  overflow: hidden;
  background: rgba(3,2,10,0.72);
  backdrop-filter: blur(6px);
}
.lang-switch button {
  border: 0;
  background: transparent;
  color: var(--text);
  font-family:'Space Mono',monospace;
  font-size: 11px;
  letter-spacing: .1em;
  text-transform: uppercase;
  padding: 10px 11px;
  cursor: pointer;
}
.lang-switch button + button {
  border-left: 1px solid rgba(255,255,255,.14);
}
.lang-switch button.active {
  color: var(--accent);
  background: rgba(255,107,53,.10);
}
.about-link {
  position: fixed;
  top: 18px;
  left: 286px;
  z-index: 121;
  border: 1px solid rgba(255,255,255,.18);
  background: rgba(3,2,10,0.72);
  color: var(--text);
  font-family:'Space Mono',monospace;
  font-size: 11px;
  letter-spacing: .1em;
  text-transform: uppercase;
  padding: 10px 13px;
  text-decoration: none;
  border-radius: 6px;
  backdrop-filter: blur(6px);
  transition: all .2s ease;
}
.about-link:hover {
  color: var(--accent);
  border-color: var(--accent);
}
.nav-btns {
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:10px;
}
.nav-main-btns {
  display:flex;
  gap:16px;
}

.slide-photo-panel {
  position: fixed;
  top: 0;
  right: 0;
  width: min(48vw, 860px);
  height: 100vh;
  z-index: 2;
  pointer-events: none;
  overflow: hidden;
}
.slide-photo-panel.is-disabled {
  display: none;
}
.slide-photo {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  object-position: center;
  opacity: 0.8;
  filter: saturate(0.9) contrast(1.05);
  transition: opacity .45s ease;
}
.slide-photo.is-loading {
  opacity: 0.1;
}
.slide-photo-fade {
  position: absolute;
  inset: 0;
  background: linear-gradient(
    to left,
    rgba(3,2,10,0.00) 0%,
    rgba(3,2,10,0.08) 60%,
    rgba(3,2,10,0.75) 70%,
    rgba(3,2,10,1.00) 78%,
    rgba(3,2,10,1.00) 100%
  );
}

@media (max-width: 1024px) {
  .slide-photo-panel { display: none; }
}

.about-section {
  position: relative;
  z-index: 20;
  min-height: 68vh;
  padding: 92px 24px 120px;
  border-top: 1px solid rgba(255,255,255,.08);
  background: linear-gradient(to bottom, rgba(3,2,10,0.84), rgba(3,2,10,0.96));
}
.about-wrap {
  max-width: 920px;
  margin: 0 auto;
  opacity: 0;
  transform: translateY(22px);
  transition: opacity .6s ease, transform .6s ease;
}
.about-wrap.is-visible {
  opacity: 1;
  transform: translateY(0);
}
.about-title {
  font-family:'Bebas Neue',sans-serif;
  font-size: clamp(34px, 6vw, 64px);
  line-height: 1;
  color: white;
  margin-bottom: 14px;
}
.about-body {
  font-size: 19px;
  line-height: 1.7;
  color: var(--text);
  max-width: 860px;
}
.about-actions {
  margin-top: 30px;
  display: grid;
  gap: 16px;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
}
.about-btn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  border: 1px solid rgba(var(--accent-rgb), 0.45);
  background: rgba(255,255,255,.02);
  color: var(--text);
  font-family:'Space Mono',monospace;
  font-size: 11px;
  letter-spacing: .09em;
  text-transform: uppercase;
  text-decoration: none;
  padding: 11px 14px;
  border-radius: 6px;
  transition: all .2s ease;
}
.about-btn:hover {
  color: var(--accent);
  border-color: var(--accent);
}
.about-card {
  border: 1px solid rgba(255,255,255,.1);
  background: rgba(255,255,255,.02);
  border-radius: 10px;
  padding: 16px;
}
.about-card h3 {
  font-family:'Space Mono',monospace;
  font-size: 12px;
  letter-spacing: .13em;
  text-transform: uppercase;
  color: var(--star);
  margin: 0 0 10px;
}
.about-card p {
  font-size: 15px;
  color: var(--dim);
  line-height: 1.6;
  margin: 0 0 14px;
}
.agent-install {
  margin-top: 10px;
  border: 1px solid rgba(255,255,255,.14);
  background: rgba(3,2,10,.55);
  border-radius: 8px;
  padding: 10px 12px;
}
.agent-install-label {
  font-family:'Space Mono',monospace;
  font-size: 10px;
  letter-spacing: .11em;
  text-transform: uppercase;
  color: var(--dim);
  margin-bottom: 6px;
}
.agent-install-code {
  font-family:'Space Mono',monospace;
  font-size: 12px;
  color: var(--text);
  word-break: break-all;
}
.about-footer {
  margin-top: 24px;
  padding-top: 14px;
  border-top: 1px solid rgba(255,255,255,.1);
  font-family:'Space Mono',monospace;
  font-size: 11px;
  line-height: 1.8;
  color: var(--dim);
}
.about-footer a {
  color: var(--text);
  text-decoration: none;
  border-bottom: 1px dotted rgba(232,213,163,.4);
}
.about-footer a:hover {
  color: var(--accent);
  border-bottom-color: rgba(255,107,53,.7);
}
</style>
</head>
<body>

<div class="cursor" id="cursor"></div>
<div class="cursor-ring" id="cursorRing"></div>
<canvas id="starfield"></canvas>
<a id="backHomeLink" class="back-home-link" href="/">← Zpět na homepage</a>
<div class="lang-switch" aria-label="Language switch">
  <button id="langCsBtn" type="button">CZ</button>
  <button id="langEnBtn" type="button">EN</button>
</div>
<a id="aboutLink" class="about-link" href="#aboutSection">About</a>
<div class="slide-photo-panel" aria-hidden="true">
  <img id="slidePhoto" class="slide-photo is-loading" alt="">
  <div class="slide-photo-fade"></div>
</div>

<div class="presentation">
 <div class="slides-wrapper" id="sw">

  <!-- SLIDE 1: HERO -->
  <div class="slide s-hero active" data-i="0">
   <div class="hero-bh-wrap">
    <svg width="480" height="480" viewBox="0 0 480 480">
     <defs>
      <radialGradient id="g0" cx="50%" cy="50%">
       <stop offset="0%" stop-color="#03020a"/>
       <stop offset="42%" stop-color="#03020a"/>
       <stop offset="68%" stop-color="#c44bff" stop-opacity="0.25"/>
       <stop offset="100%" stop-color="#ff6b35" stop-opacity="0"/>
      </radialGradient>
     </defs>
     <circle cx="240" cy="240" r="230" fill="url(#g0)"/>
     <circle cx="240" cy="240" r="92" fill="#03020a"/>
     <ellipse cx="240" cy="240" rx="155" ry="38" fill="none" stroke="#c44bff" stroke-width="3" opacity="0.5" style="animation:rotate 9s linear infinite;transform-origin:240px 240px;"/>
     <ellipse cx="240" cy="240" rx="190" ry="50" fill="none" stroke="#ff6b35" stroke-width="1.5" opacity="0.3" style="animation:rotate 13s linear infinite reverse;transform-origin:240px 240px;"/>
     <ellipse cx="240" cy="240" rx="125" ry="30" fill="none" stroke="#5bb4ff" stroke-width="2" opacity="0.25" style="animation:rotate 7s linear infinite;transform-origin:240px 240px;"/>
    </svg>
   </div>
   <div style="position:relative;z-index:1;">
    <div class="hero-eyebrow">01 · Úvod</div>
    <div class="hero-title">ČERNÉ<br><span class="outline">DÍRY</span></div>
    <div class="hero-sub">Tam, kde přestávají platit zákony fyziky</div>
   </div>
  </div>

  <!-- SLIDE 2: CO JE ČERNÁ DÍRA -->
  <div class="slide s-def" data-i="1">
   <div class="def-visual">
    <svg width="360" height="360" viewBox="0 0 360 360">
     <defs>
      <radialGradient id="g2" cx="50%" cy="50%">
       <stop offset="0%" stop-color="#000"/>
       <stop offset="43%" stop-color="#000"/>
       <stop offset="60%" stop-color="#c44bff" stop-opacity="0.45"/>
       <stop offset="85%" stop-color="#ff6b35" stop-opacity="0.15"/>
       <stop offset="100%" stop-color="transparent"/>
      </radialGradient>
      <linearGradient id="acc2" x1="0%" y1="0%" x2="100%" y2="0%">
       <stop offset="0%" stop-color="#ff6b35"/>
       <stop offset="50%" stop-color="#c44bff"/>
       <stop offset="100%" stop-color="#5bb4ff"/>
      </linearGradient>
     </defs>
     <circle cx="180" cy="180" r="145" fill="rgba(196,75,255,0.03)"/>
     <circle cx="180" cy="180" r="115" fill="none" stroke="#c44bff" stroke-width="0.8" opacity="0.15" style="animation:pulse 4s ease-in-out infinite;transform-origin:180px 180px;"/>
     <ellipse cx="180" cy="180" rx="148" ry="36" fill="none" stroke="url(#acc2)" stroke-width="11" opacity="0.65" style="animation:rotate 10s linear infinite;transform-origin:180px 180px;"/>
     <ellipse cx="180" cy="180" rx="122" ry="30" fill="none" stroke="#ff6b35" stroke-width="4" opacity="0.4" style="animation:rotate 8s linear infinite reverse;transform-origin:180px 180px;"/>
     <circle cx="180" cy="180" r="72" fill="url(#g2)"/>
     <circle cx="180" cy="180" r="58" fill="#03020a"/>
     <circle cx="180" cy="180" r="60" fill="none" stroke="rgba(196,75,255,0.55)" stroke-width="2"/>
     <circle cx="180" cy="180" r="86" fill="none" stroke="rgba(91,180,255,0.2)" stroke-width="1" stroke-dasharray="3,5"/>
     <line x1="180" y1="108" x2="256" y2="56" stroke="rgba(232,213,163,0.25)" stroke-width="1" stroke-dasharray="4,3"/>
     <text x="260" y="54" font-family="Space Mono" font-size="8" fill="#e8d5a3" opacity="0.6">Schwarzschildův</text>
     <text x="260" y="66" font-family="Space Mono" font-size="8" fill="#e8d5a3" opacity="0.6">poloměr</text>
     <text x="276" y="165" font-family="Space Mono" font-size="8" fill="#5bb4ff" opacity="0.5">fotonová sféra</text>
    </svg>
   </div>
   <div>
    <div class="slide-label">02 · Definice</div>
    <h2 class="slide-heading">Co je<br>černá díra?</h2>
    <p class="slide-body">Oblast vesmíru, kde <strong>gravitace je tak silná</strong>, že nic — ani světlo — nemůže uniknout. Vzniká kolapsem <strong>masivní hvězdy</strong> na konci jejího života.</p>
    <p class="slide-body" style="margin-top:14px;">Hranice, za kterou není návratu, se nazývá <strong>horizont událostí</strong>. Není to fyzická zeď — je to matematická hranice prostoru a času.</p>
    <div class="fact-box">
     <div class="fact-label">⚡ Rychlý fakt</div>
     <div class="fact-text">Sgr A* — černá díra v centru Mléčné dráhy — má hmotnost 4 milionů Sluncí.</div>
    </div>
   </div>
  </div>

  <!-- SLIDE 3: ANATOMIE -->
  <div class="slide s-anat" data-i="2">
   <div class="anat-diagram">
    <svg width="400" height="420" viewBox="0 0 400 420">
     <defs>
      <radialGradient id="g3" cx="50%" cy="50%">
       <stop offset="0%" stop-color="#ff6b35" stop-opacity="0.7"/>
       <stop offset="28%" stop-color="#c44bff" stop-opacity="0.35"/>
       <stop offset="55%" stop-color="#03020a"/>
       <stop offset="100%" stop-color="#03020a"/>
      </radialGradient>
     </defs>
     <ellipse cx="200" cy="210" rx="160" ry="40" fill="none" stroke="rgba(255,107,53,0.35)" stroke-width="9" style="animation:rotate 9s linear infinite;transform-origin:200px 210px;"/>
     <ellipse cx="200" cy="210" rx="138" ry="33" fill="none" stroke="#c44bff" stroke-width="3" opacity="0.25" style="animation:rotate 7s linear infinite reverse;transform-origin:200px 210px;"/>
     <ellipse cx="200" cy="210" rx="125" ry="30" fill="none" stroke="rgba(255,107,53,0.15)" stroke-width="18" style="animation:rotate 9s linear infinite;transform-origin:200px 210px;"/>
     <circle cx="200" cy="210" r="78" fill="none" stroke="rgba(196,75,255,0.45)" stroke-width="2" stroke-dasharray="6,3"/>
     <circle cx="200" cy="210" r="52" fill="url(#g3)"/>
     <circle cx="200" cy="210" r="38" fill="#03020a"/>
     <circle cx="200" cy="210" r="5" fill="#ff6b35"><animate attributeName="r" values="3;7;3" dur="2s" repeatCount="indefinite"/><animate attributeName="opacity" values="1;0.4;1" dur="2s" repeatCount="indefinite"/></circle>
     <line x1="200" y1="132" x2="200" y2="15" stroke="rgba(91,180,255,0.45)" stroke-width="3"><animate attributeName="opacity" values=".3;.8;.3" dur="1.5s" repeatCount="indefinite"/></line>
     <line x1="200" y1="288" x2="200" y2="405" stroke="rgba(91,180,255,0.45)" stroke-width="3"><animate attributeName="opacity" values=".3;.8;.3" dur="1.5s" begin=".75s" repeatCount="indefinite"/></line>
     <line x1="248" y1="210" x2="318" y2="195" stroke="rgba(196,75,255,0.25)" stroke-width="1" stroke-dasharray="3,3"/>
     <text x="322" y="193" font-family="Space Mono" font-size="8" fill="#c44bff" opacity="0.7">Horizont událostí</text>
     <line x1="200" y1="172" x2="310" y2="135" stroke="rgba(255,107,53,0.25)" stroke-width="1" stroke-dasharray="3,3"/>
     <text x="314" y="133" font-family="Space Mono" font-size="8" fill="#ff6b35" opacity="0.7">Singularita</text>
     <text x="108" y="70" font-family="Space Mono" font-size="8" fill="#5bb4ff" opacity="0.6">Relativistický jet</text>
     <text x="32" y="235" font-family="Space Mono" font-size="8" fill="#e8d5a3" opacity="0.55">Akreční disk</text>
    </svg>
   </div>
   <div class="anat-content">
    <div class="slide-label">03 · Anatomie</div>
    <h2 class="slide-heading">Vnitřní<br>struktura</h2>
    <div class="anat-item" id="ai1">
     <div class="anat-num">01</div>
     <div class="anat-info"><h4>Singularita</h4><p>Bod nekonečné hustoty ve středu. Fyzika zde přestává fungovat — prostoročas se láme.</p></div>
    </div>
    <div class="anat-item" id="ai2">
     <div class="anat-num">02</div>
     <div class="anat-info"><h4>Horizont událostí</h4><p>Jednosměrná membrána prostoru. Překročit ji lze jen jedním směrem — dovnitř.</p></div>
    </div>
    <div class="anat-item" id="ai3">
     <div class="anat-num">03</div>
     <div class="anat-info"><h4>Akreční disk</h4><p>Rozžhavená spirála plynu padající dovnitř — tak horká, že září rentgenovým zářením.</p></div>
    </div>
    <div class="anat-item" id="ai4">
     <div class="anat-num">04</div>
     <div class="anat-info"><h4>Relativistické jety</h4><p>Paprsky plazmy vystřelené na pólech rychlostí blízkou světlu — na tisíce světelných let.</p></div>
    </div>
   </div>
  </div>

  <!-- SLIDE 3.5: FILOSOFIE ČASU -->
  <div class="slide" style="gap:0;flex-direction:column;align-items:center;justify-content:center;padding:50px 80px;width:min(1320px,100%);margin:0 auto;" data-i="3">
    <div style="display:flex;width:100%;max-width:1240px;margin:0 auto;gap:70px;align-items:center;">

      <!-- CANVAS AREA with model toggle -->
      <div style="flex:0 0 420px;position:relative;">

        <!-- Model toggle pills -->
        <div style="display:flex;gap:0;margin-bottom:10px;border:1px solid rgba(255,255,255,0.08);border-radius:3px;overflow:hidden;width:fit-content;">
          <button id="btnModelA" onclick="switchPhiloModel('a')" style="
            background:rgba(196,75,255,0.18);border:none;color:#c44bff;
            font-family:'Space Mono',monospace;font-size:8px;letter-spacing:0.12em;
            padding:6px 14px;cursor:pointer;text-transform:uppercase;transition:all 0.2s;">
            VNĚJŠÍ HMOTA
          </button>
          <button id="btnModelB" onclick="switchPhiloModel('b')" style="
            background:transparent;border:none;color:rgba(255,255,255,0.25);
            font-family:'Space Mono',monospace;font-size:8px;letter-spacing:0.12em;
            padding:6px 14px;cursor:pointer;text-transform:uppercase;transition:all 0.2s;">
            HUSTOTA ČÁSTIC
          </button>
        </div>

        <!-- Canvas A — external gravity wells -->
        <div id="canvasWrapA" style="position:relative;height:420px;">
          <canvas id="particleCanvas" width="420" height="420" style="border-radius:4px;display:block;"></canvas>
          <div id="canvasACaption" style="position:absolute;bottom:10px;left:0;right:0;text-align:center;font-family:'Space Mono',monospace;font-size:9px;color:rgba(255,255,255,0.18);letter-spacing:0.12em;">klikni — přidej hmotu</div>
        </div>

        <!-- Canvas B — density model -->
        <div id="canvasWrapB" style="position:relative;height:420px;display:none;">
          <canvas id="densityCanvas" width="420" height="420" style="border-radius:4px;display:block;"></canvas>
          <button id="densityModeBtn" onclick="toggleDensityMode()" style="
            position:absolute;top:8px;right:8px;
            background:rgba(10,5,25,0.85);border:1px solid rgba(255,107,53,0.45);
            color:#ff6b35;font-family:'Space Mono',monospace;font-size:8px;
            letter-spacing:0.12em;padding:5px 11px;cursor:pointer;
            text-transform:uppercase;transition:all 0.2s;border-radius:2px;">+ PŘIDAT</button>
          <div id="canvasBCaption" style="position:absolute;bottom:10px;left:0;right:0;text-align:center;font-family:'Space Mono',monospace;font-size:9px;color:rgba(255,255,255,0.18);letter-spacing:0.12em;">klikni na canvas</div>
        </div>
      </div>

      <!-- TEXT — unchanged from original 03b -->
      <div style="flex:1;">
        <div class="slide-label">04 · Filosofie</div>
        <h2 class="slide-heading" style="font-size:clamp(40px,4.5vw,64px);margin-bottom:24px;">Hmota<br>zpomaluje<br>čas</h2>

        <p class="slide-body" style="font-size:16px;">
          Dilatace času není magický efekt. Je to <strong>přirozený důsledek hustoty</strong>. 
          Čím více hmoty na jednom místě, tím pomalejší jsou interakce mezi částicemi — 
          elektromagnetické výměny, oscilace, reakce.
        </p>

        <p class="slide-body" style="font-size:16px;margin-top:16px;">
          Hodinky netikají díky mechanismu — tikají díky <strong>elektromagnetickým interakcím</strong> 
          mezi atomy. V silném gravitačním poli se tyhle interakce zpomalí. 
          Hodiny prostě méně „stihnou".
        </p>

        <div style="margin-top:32px;padding:22px 26px;border:1px solid rgba(196,75,255,0.2);background:rgba(196,75,255,0.04);position:relative;">
          <div style="position:absolute;top:-18px;left:18px;font-family:'Bebas Neue',sans-serif;font-size:80px;color:rgba(196,75,255,0.08);line-height:1;">"</div>
          <div id="philoQuoteText" class="quote-text" style="font-size:16px;font-style:italic;color:#c44bff;line-height:1.7;position:relative;z-index:1;">
            Velké množství hmoty si navzájem zpomaluje vlastní existenci. 
            Čas není absolutní — je to tempo,<br>kterým věci reagují.
          </div>
          <div id="philoQuoteSrc" style="margin-top:12px;font-family:'Space Mono',monospace;font-size:9px;color:var(--dim);letter-spacing:0.15em;">— fyzikální interpretace obecné relativity</div>
        </div>

        <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-top:28px;">
          <div style="border-left:1px solid rgba(255,107,53,0.3);padding-left:12px;">
            <div style="font-family:'Space Mono',monospace;font-size:9px;color:var(--accent);letter-spacing:0.15em;margin-bottom:5px;">GPS SATELITY</div>
            <div style="font-size:12px;color:var(--dim);line-height:1.5;">Bez korekce dilatace by se GPS mýlilo o 11 km/den</div>
          </div>
          <div style="border-left:1px solid rgba(196,75,255,0.3);padding-left:12px;">
            <div style="font-family:'Space Mono',monospace;font-size:9px;color:var(--plasma);letter-spacing:0.15em;margin-bottom:5px;">PŘÍZEMÍ VS. HORA</div>
            <div style="font-size:12px;color:var(--dim);line-height:1.5;">Hodiny v přízemí tikají o 45 ns/den pomaleji než na vrcholu Everestu</div>
          </div>
          <div style="border-left:1px solid rgba(91,180,255,0.3);padding-left:12px;">
            <div style="font-family:'Space Mono',monospace;font-size:9px;color:var(--cold);letter-spacing:0.15em;margin-bottom:5px;">HORIZONT UDÁLOSTÍ</div>
            <div style="font-size:12px;color:var(--dim);line-height:1.5;">Na horizontu se interakce zastaví úplně — čas se pro vnějšího pozorovatele zastaví</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- SLIDE 4: TYPY -->
  <div class="slide s-types" data-i="4">
   <div class="types-hdr">
    <div>
     <div class="slide-label">05 · Klasifikace</div>
     <h2 class="slide-heading" style="font-size:52px;">Typy černých děr</h2>
    </div>
    <div style="font-family:'Space Mono',monospace;font-size:10px;color:var(--dim);text-align:right;">Schwarzschildův poloměr<br>vs. poloměr Slunce (696 000 km)</div>
   </div>
   <div class="types-grid">


    <!-- ═══════════════════════════════════════════
         HVĚZDNÁ  │  střední: 17 M☉ → r ≈ 50 km
         Slunce 696 000 km → poměr 1 : 13 864
         Vizuál: Slunce plný kruh 46px, BH = 46/13864 ≈ 0.003px → ukážeme 3px dot + label
    ════════════════════════════════════════════ -->
    <div class="type-card" style="--cc:#5bb4ff;">
      <div style="height:130px;position:relative;margin-bottom:14px;">
        <svg width="100%" height="130" viewBox="0 0 260 130" preserveAspectRatio="xMidYMid meet">
          <defs>
            <radialGradient id="sg1" cx="40%" cy="38%">
              <stop offset="0%" stop-color="#fffbe0"/>
              <stop offset="35%" stop-color="#ffe566"/>
              <stop offset="70%" stop-color="#ffaa00"/>
              <stop offset="100%" stop-color="#ff6600" stop-opacity="0.5"/>
            </radialGradient>
            <radialGradient id="bg1" cx="50%" cy="50%">
              <stop offset="0%" stop-color="#000510"/>
              <stop offset="60%" stop-color="#001428"/>
              <stop offset="100%" stop-color="#5bb4ff" stop-opacity="0.6"/>
            </radialGradient>
            <filter id="sg1f"><feGaussianBlur stdDeviation="4" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
            <filter id="bg1f"><feGaussianBlur stdDeviation="2.5" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
          </defs>

          <!-- SUN — radius 46px = 696 000 km -->
          <circle cx="70" cy="65" r="46" fill="url(#sg1)" filter="url(#sg1f)"/>
          <!-- surface texture lines -->
          <circle cx="70" cy="65" r="46" fill="none" stroke="#ffdd44" stroke-width="0.5" opacity="0.3"/>

          <!-- scale bracket -->
          <line x1="24" y1="116" x2="116" y2="116" stroke="rgba(255,204,68,0.25)" stroke-width="0.8"/>
          <line x1="24" y1="112" x2="24" y2="120" stroke="rgba(255,204,68,0.25)" stroke-width="0.8"/>
          <line x1="116" y1="112" x2="116" y2="120" stroke="rgba(255,204,68,0.25)" stroke-width="0.8"/>
          <text x="70" y="128" text-anchor="middle" font-family="Space Mono" font-size="7.5" fill="#ffcc44" opacity="0.65">☉ 696 000 km</text>

          <!-- divider -->
          <line x1="148" y1="10" x2="148" y2="115" stroke="rgba(255,255,255,0.05)" stroke-width="1" stroke-dasharray="3,4"/>
          <text x="148" y="8" text-anchor="middle" font-family="Space Mono" font-size="6" fill="rgba(255,255,255,0.15)">stejné měřítko</text>

          <!-- BH — r = 50 km → 50/696000 * 46px = 0.003px → min 3px dot -->
          <circle cx="200" cy="65" r="3" fill="url(#bg1)" filter="url(#bg1f)"/>
          <circle cx="200" cy="65" r="5" fill="none" stroke="#5bb4ff" stroke-width="1" opacity="0.7">
            <animate attributeName="r" values="5;8;5" dur="2s" repeatCount="indefinite"/>
            <animate attributeName="opacity" values="0.7;0.2;0.7" dur="2s" repeatCount="indefinite"/>
          </circle>
          <!-- pointer to tiny dot -->
          <line x1="200" y1="34" x2="200" y2="53" stroke="rgba(91,180,255,0.35)" stroke-width="1" stroke-dasharray="2,2"/>
          <text x="200" y="58" text-anchor="middle" font-family="Space Mono" font-size="7" fill="#5bb4ff" opacity="0.8">▼</text>
          <text x="200" y="105" text-anchor="middle" font-family="Space Mono" font-size="7.5" fill="#5bb4ff" opacity="0.7">~50 km</text>
          <text x="200" y="116" text-anchor="middle" font-family="Space Mono" font-size="6.5" fill="#6b6580">13 864× menší</text>
        </svg>
      </div>
      <div class="type-mass">3–100</div>
      <div class="type-unit">solárních hmotností · střed 17 M☉</div>
      <div class="type-name">Hvězdné</div>
      <div class="type-desc">Vznikají kolapsem masivních hvězd. Poloměr jen <strong style="color:#5bb4ff;">~50 km</strong> — menší než Praha. Slunce je 14 000× větší.</div>
      <div class="type-ex">→ Cygnus X-1 · GW150914</div>
    </div>

    <!-- ═══════════════════════════════════════════
         STŘEDNÍ  │  střed: 3 162 M☉ → r ≈ 9 337 km
         Slunce 696 000 km → poměr 1 : 74.5
         Vizuál: Slunce 40px → BH = 40/74.5 ≈ 0.54px → ukážeme 5-6px
    ════════════════════════════════════════════ -->
    <div class="type-card" style="--cc:#c44bff;">
      <div style="height:130px;position:relative;margin-bottom:14px;">
        <svg width="100%" height="130" viewBox="0 0 260 130" preserveAspectRatio="xMidYMid meet">
          <defs>
            <radialGradient id="sg2" cx="40%" cy="38%">
              <stop offset="0%" stop-color="#fffbe0"/>
              <stop offset="35%" stop-color="#ffe566"/>
              <stop offset="70%" stop-color="#ffaa00"/>
              <stop offset="100%" stop-color="#ff6600" stop-opacity="0.5"/>
            </radialGradient>
            <radialGradient id="bg2" cx="50%" cy="50%">
              <stop offset="0%" stop-color="#0a0018"/>
              <stop offset="55%" stop-color="#1a0035"/>
              <stop offset="100%" stop-color="#c44bff" stop-opacity="0.5"/>
            </radialGradient>
            <filter id="sg2f"><feGaussianBlur stdDeviation="4" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
            <filter id="bg2f"><feGaussianBlur stdDeviation="3" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
          </defs>

          <!-- SUN — 40px = 696 000 km -->
          <circle cx="68" cy="65" r="40" fill="url(#sg2)" filter="url(#sg2f)"/>
          <line x1="28" y1="116" x2="108" y2="116" stroke="rgba(255,204,68,0.25)" stroke-width="0.8"/>
          <line x1="28" y1="112" x2="28" y2="120" stroke="rgba(255,204,68,0.25)" stroke-width="0.8"/>
          <line x1="108" y1="112" x2="108" y2="120" stroke="rgba(255,204,68,0.25)" stroke-width="0.8"/>
          <text x="68" y="128" text-anchor="middle" font-family="Space Mono" font-size="7.5" fill="#ffcc44" opacity="0.65">☉ 696 000 km</text>

          <!-- divider -->
          <line x1="140" y1="10" x2="140" y2="115" stroke="rgba(255,255,255,0.05)" stroke-width="1" stroke-dasharray="3,4"/>
          <text x="140" y="8" text-anchor="middle" font-family="Space Mono" font-size="6" fill="rgba(255,255,255,0.15)">stejné měřítko</text>

          <!-- BH — r = 9337 km → 9337/696000 * 40px ≈ 0.54px → zobrazíme min 5.5px se správným popisem -->
          <!-- At true scale would be sub-pixel, so we show minimum 5.5px with annotation -->
          <circle cx="198" cy="65" r="5.5" fill="url(#bg2)" filter="url(#bg2f)"/>
          <circle cx="198" cy="65" r="8" fill="none" stroke="#c44bff" stroke-width="1" opacity="0.55">
            <animate attributeName="r" values="8;11;8" dur="2.5s" repeatCount="indefinite"/>
            <animate attributeName="opacity" values="0.55;0.15;0.55" dur="2.5s" repeatCount="indefinite"/>
          </circle>
          <line x1="198" y1="34" x2="198" y2="52" stroke="rgba(196,75,255,0.4)" stroke-width="1" stroke-dasharray="2,2"/>
          <text x="198" y="57" text-anchor="middle" font-family="Space Mono" font-size="7" fill="#c44bff" opacity="0.8">▼</text>
          <text x="198" y="105" text-anchor="middle" font-family="Space Mono" font-size="7.5" fill="#c44bff" opacity="0.7">~9 337 km</text>
          <text x="198" y="116" text-anchor="middle" font-family="Space Mono" font-size="6.5" fill="#6b6580">74× menší</text>
        </svg>
      </div>
      <div class="type-mass">10²–10⁵</div>
      <div class="type-unit">solárních hmotností · střed 3 162 M☉</div>
      <div class="type-name">Střední</div>
      <div class="type-desc">Záhadný mezičlánek. Poloměr <strong style="color:#c44bff;">~9 300 km</strong> — jako průměr Země. Slunce je stále 74× větší.</div>
      <div class="type-ex">→ HLX-1 · NGC 1277</div>
    </div>

    <!-- ═══════════════════════════════════════════
         SUPERMASIVNÍ  │  střed: 10⁸ M☉ → r ≈ 295 mil km
         Slunce 696 000 km → BH je 424× větší než Slunce
         Vizuál: BH zabírá vše, Slunce = tečka 1px
    ════════════════════════════════════════════ -->
    <div class="type-card" style="--cc:#ff6b35;">
      <div style="height:130px;position:relative;margin-bottom:14px;">
        <svg width="100%" height="130" viewBox="0 0 260 130" preserveAspectRatio="xMidYMid meet">
          <defs>
            <radialGradient id="bg3" cx="50%" cy="50%">
              <stop offset="0%" stop-color="#0a0200"/>
              <stop offset="40%" stop-color="#1a0500"/>
              <stop offset="72%" stop-color="#ff6b35" stop-opacity="0.3"/>
              <stop offset="88%" stop-color="#ff6b35" stop-opacity="0.12"/>
              <stop offset="100%" stop-color="#ff6b35" stop-opacity="0"/>
            </radialGradient>
            <radialGradient id="sg3" cx="40%" cy="38%">
              <stop offset="0%" stop-color="#fffbe0"/>
              <stop offset="50%" stop-color="#ffe566"/>
              <stop offset="100%" stop-color="#ff8800"/>
            </radialGradient>
            <filter id="bg3f"><feGaussianBlur stdDeviation="5" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
            <filter id="sg3f"><feGaussianBlur stdDeviation="1.5" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
            <clipPath id="clip3"><rect width="260" height="130"/></clipPath>
            <marker id="marr3" markerWidth="5" markerHeight="5" refX="4" refY="2.5" orient="auto">
              <path d="M0,0 L5,2.5 L0,5 Z" fill="rgba(255,204,68,0.5)"/>
            </marker>
          </defs>

          <!-- BH is 424× bigger than Sun → if BH = 210px radius, Sun = 0.5px -->
          <!-- We show BH as huge glow filling the right side, Sun as tiny labeled dot left -->
          <g clip-path="url(#clip3)">
            <!-- BH glow centered off-right so it fills the canvas dramatically -->
            <circle cx="195" cy="65" r="130" fill="url(#bg3)" filter="url(#bg3f)" opacity="0.9"/>
            <!-- BH core — black absolute -->
            <circle cx="195" cy="65" r="80" fill="#03020a"/>
            <!-- event horizon ring -->
            <circle cx="195" cy="65" r="80" fill="none" stroke="#ff6b35" stroke-width="1.5" opacity="0.5"/>
            <!-- accretion disk -->
            <ellipse cx="195" cy="65" rx="95" ry="18" fill="none" stroke="#ff6b35" stroke-width="3" opacity="0.35" style="animation:rotate 10s linear infinite;transform-origin:195px 65px;"/>
            <ellipse cx="195" cy="65" rx="88" ry="15" fill="none" stroke="#ffaa44" stroke-width="1.5" opacity="0.2" style="animation:rotate 7s linear infinite reverse;transform-origin:195px 65px;"/>
          </g>

          <!-- SUN — true scale: 696000/295300000 * 80px ≈ 0.19px → show as 2px dot with arrow -->
          <circle cx="22" cy="65" r="2" fill="url(#sg3)" filter="url(#sg3f)"/>
          <!-- arrow from label to dot -->
          <line x1="22" y1="45" x2="22" y2="60" stroke="rgba(255,204,68,0.4)" stroke-width="1" marker-end="url(#marr3)"/>
          <text x="22" y="41" text-anchor="middle" font-family="Space Mono" font-size="6.5" fill="#ffcc44" opacity="0.7">☉</text>
          <text x="22" y="33" text-anchor="middle" font-family="Space Mono" font-size="5.5" fill="#6b6580">Slunce</text>

          <!-- BH size label -->
          <text x="145" y="118" text-anchor="middle" font-family="Space Mono" font-size="7.5" fill="#ff6b35" opacity="0.75">295 mil. km (= 424× Slunce)</text>
        </svg>
      </div>
      <div class="type-mass">10⁶–10¹⁰</div>
      <div class="type-unit">solárních hmotností · střed 10⁸ M☉</div>
      <div class="type-name">Supermasivní</div>
      <div class="type-desc">Kolosy v centrech galaxií. Poloměr <strong style="color:#ff6b35;">295 mil. km</strong> — 2× vzdálenost Země od Slunce. Pohltí celou sluneční soustavu až za Mars.</div>
      <div class="type-ex">→ Sgr A* · M87* · TON 618</div>
    </div>

   </div>
  </div>

  <!-- SLIDE 5: SPAGHETTIFICATION -->
  <div class="slide s-spag" data-i="5">
   <div class="spag-vis">
    <svg width="320" height="400" viewBox="0 0 320 400">
     <defs>
      <linearGradient id="spag" x1="0%" y1="0%" x2="0%" y2="100%">
       <stop offset="0%" stop-color="#5bb4ff" stop-opacity="0.8"/>
       <stop offset="50%" stop-color="#c44bff" stop-opacity="0.7"/>
       <stop offset="100%" stop-color="#ff6b35"/>
      </linearGradient>
     </defs>
     <circle cx="160" cy="368" r="42" fill="#03020a"/>
     <circle cx="160" cy="368" r="44" fill="none" stroke="rgba(196,75,255,0.5)" stroke-width="1.5"/>
     <ellipse cx="160" cy="368" rx="85" ry="20" fill="none" stroke="#ff6b35" stroke-width="3" opacity="0.4" style="animation:rotate 6s linear infinite;transform-origin:160px 368px;"/>
     <path d="M 138 320 Q 144 240 150 140 Q 153 70 156 15" fill="none" stroke="url(#spag)" stroke-width="6" stroke-linecap="round" opacity="0.9"><animate attributeName="stroke-dashoffset" from="0" to="-300" dur="2s" repeatCount="indefinite"/></path>
     <path d="M 145 318 Q 150 238 155 138 Q 157 68 159 14" fill="none" stroke="url(#spag)" stroke-width="4" stroke-linecap="round" opacity="0.65"/>
     <path d="M 177 320 Q 172 240 167 140 Q 164 70 162 14" fill="none" stroke="url(#spag)" stroke-width="5" stroke-linecap="round" opacity="0.8"><animate attributeName="stroke-dashoffset" from="0" to="-280" dur="1.8s" repeatCount="indefinite"/></path>
     <path d="M 184 322 Q 178 242 172 142 Q 168 72 165 16" fill="none" stroke="url(#spag)" stroke-width="3" stroke-linecap="round" opacity="0.5"/>
     <circle cx="160" cy="24" r="12" fill="rgba(91,180,255,0.25)" stroke="#5bb4ff" stroke-width="1.5"/>
     <rect x="153" y="36" width="14" height="18" rx="3" fill="rgba(91,180,255,0.15)" stroke="#5bb4ff" stroke-width="1.5"/>
    </svg>
   </div>
   <div>
    <div class="slide-label">06 · Spaghettifikace</div>
    <h2 class="slide-heading">Efekt<br>špagetizace</h2>
    <p class="slide-body">Jak se těleso blíží horizontu, <strong>gravitační gradient</strong> mezi jeho bližší a vzdálenější stranou roste exponenciálně. Těleso je <strong>natahováno jako špagety</strong> podél pádu.</p>
    <div class="big-stat">10¹⁰</div>
    <div class="big-stat-lbl">Newton/kg — přílivové síly u hvězdné černé díry</div>
    <p class="slide-body" style="margin-top:22px;font-size:15px;">U <strong>supermasivních</strong> černých děr je efekt paradoxně slabší — horizont je tak daleko od středu, že gradient je menší. Mohli bys přejít horizont bez okamžité smrti.</p>
   </div>
  </div>

  <!-- SLIDE 6: DILATACE ČASU -->
  <div class="slide s-time" data-i="6">
   <div class="time-vis">
    <svg width="400" height="420" viewBox="0 0 400 420">
     <defs>
      <marker id="arrG" markerWidth="8" markerHeight="8" refX="6" refY="3" orient="auto">
       <path d="M0,0 L6,3 L0,6 Z" fill="rgba(232,213,163,0.4)"/>
      </marker>
     </defs>
     <!-- Far clock -->
     <circle cx="90" cy="115" r="52" fill="rgba(91,180,255,0.04)" stroke="#5bb4ff" stroke-width="1.5" opacity="0.8"/>
     <text x="90" y="78" text-anchor="middle" font-family="Space Mono" font-size="8" fill="#5bb4ff" opacity="0.6">DALEKO OD BH</text>
     <circle cx="90" cy="115" r="40" fill="none" stroke="rgba(91,180,255,0.2)" stroke-width="1"/>
     <line x1="90" y1="79" x2="90" y2="85" stroke="#5bb4ff" stroke-width="2" opacity="0.6"/>
     <line x1="90" y1="145" x2="90" y2="151" stroke="#5bb4ff" stroke-width="2" opacity="0.6"/>
     <line x1="54" y1="115" x2="60" y2="115" stroke="#5bb4ff" stroke-width="2" opacity="0.6"/>
     <line x1="120" y1="115" x2="126" y2="115" stroke="#5bb4ff" stroke-width="2" opacity="0.6"/>
     <line x1="90" y1="115" x2="90" y2="89" stroke="#5bb4ff" stroke-width="2" stroke-linecap="round" style="animation:clockTick 4s linear infinite;transform-origin:90px 115px;"/>
     <line x1="90" y1="115" x2="106" y2="115" stroke="#5bb4ff" stroke-width="1.5" stroke-linecap="round" style="animation:clockTick 48s linear infinite;transform-origin:90px 115px;"/>
     <circle cx="90" cy="115" r="3" fill="#5bb4ff"/>
     <!-- Near clock (slow) -->
     <circle cx="295" cy="305" r="52" fill="rgba(255,107,53,0.04)" stroke="#ff6b35" stroke-width="1.5" opacity="0.8"/>
     <text x="295" y="268" text-anchor="middle" font-family="Space Mono" font-size="8" fill="#ff6b35" opacity="0.6">BLÍZKO BH</text>
     <circle cx="295" cy="305" r="40" fill="none" stroke="rgba(255,107,53,0.2)" stroke-width="1"/>
     <line x1="295" y1="269" x2="295" y2="275" stroke="#ff6b35" stroke-width="2" opacity="0.6"/>
     <line x1="295" y1="335" x2="295" y2="341" stroke="#ff6b35" stroke-width="2" opacity="0.6"/>
     <line x1="259" y1="305" x2="265" y2="305" stroke="#ff6b35" stroke-width="2" opacity="0.6"/>
     <line x1="325" y1="305" x2="331" y2="305" stroke="#ff6b35" stroke-width="2" opacity="0.6"/>
     <line x1="295" y1="305" x2="295" y2="279" stroke="#ff6b35" stroke-width="2" stroke-linecap="round" style="animation:clockTick 24s linear infinite;transform-origin:295px 305px;"/>
     <line x1="295" y1="305" x2="311" y2="305" stroke="#ff6b35" stroke-width="1.5" stroke-linecap="round" style="animation:clockTick 288s linear infinite;transform-origin:295px 305px;"/>
     <circle cx="295" cy="305" r="3" fill="#ff6b35"/>
     <!-- Arrow -->
     <path d="M 142 135 Q 200 195 242 268" fill="none" stroke="rgba(232,213,163,0.25)" stroke-width="1.5" stroke-dasharray="5,4" marker-end="url(#arrG)"/>
     <text x="188" y="210" text-anchor="middle" font-family="Space Mono" font-size="9" fill="#e8d5a3" opacity="0.45">6× pomalejší čas</text>
     <!-- BH dot -->
     <circle cx="340" cy="380" r="22" fill="#03020a"/>
     <circle cx="340" cy="380" r="23" fill="none" stroke="rgba(196,75,255,0.4)" stroke-width="1.5"/>
     <text x="340" y="414" text-anchor="middle" font-family="Space Mono" font-size="8" fill="#c44bff" opacity="0.5">BH</text>
    </svg>
   </div>
   <div>
    <div class="slide-label">07 · Relativita</div>
    <h2 class="slide-heading">Dilatace<br>času</h2>
    <p class="slide-body">Čím silnější gravitace, tím <strong>pomaleji plyne čas</strong>. Hodiny u horizontu tikou pro vzdáleného pozorovatele téměř nehybně — efekt Einsteinovy <strong>obecné teorie relativity</strong>.</p>
    <p class="slide-body" style="margin-top:14px;">Astronaut padající dovnitř pro sebe nic zvláštního nezažívá. Pro přítele venku se zdá <strong>zmrznout</strong> těsně před horizontem — navždy.</p>
    <div class="quote-block">
     <div class="quote-text">Jeden rok v blízkosti černé díry odpovídá sedmi letům na Zemi.</div>
     <div class="quote-src">— Film Interstellar · Fyzikální základ: Kip Thorne</div>
    </div>
   </div>
  </div>

  <!-- SLIDE 7: HAWKINGOVO ZÁŘENÍ -->
  <div class="slide s-hawk" data-i="7">
   <div class="slide-label" style="margin:0 auto 12px;">08 · Kvantová fyzika</div>
   <h2 class="slide-heading" style="text-align:center;font-size:68px;">Hawkingovo záření</h2>
   <p class="slide-body" style="text-align:center;max-width:620px;margin:0 auto;">Stephen Hawking roku 1974 předpověděl, že kvantové fluktuace vakua u horizontu způsobují, že částice <strong>unikají</strong>. Černá díra tak pomalu <strong>odpaří</strong>.</p>
   <div class="hawk-eq">T = ℏc³ / (8πGMk<sub>B</sub>)</div>
   <div class="hawk-grid">
    <div class="hawk-item">
     <div class="hawk-icon">⚛️</div>
     <h4>Virtuální páry</h4>
     <p>U horizontu vznikají páry částice–antičástice. Jedna padá dovnitř, druhá uniká jako záření.</p>
    </div>
    <div class="hawk-item">
     <div class="hawk-icon">🌡️</div>
     <h4>Teplota záření</h4>
     <p>Čím menší černá díra, tím vyšší teplota. Hvězdné černé díry mají teplotu miliardinu Kelvinu.</p>
    </div>
    <div class="hawk-item">
     <div class="hawk-icon">⏳</div>
     <h4>Odpařování</h4>
     <p>Černá díra hmotnosti Slunce by se odpařila za 2×10⁶⁷ let. Vesmír je starý 1,4×10¹⁰ let.</p>
    </div>
   </div>
  </div>

  <!-- SLIDE 8: FINALE -->
  <div class="slide s-finale" data-i="8">
   <div class="finale-bg-num">∞</div>
   <div class="finale-inner">
    <div class="finale-tag">09 · Závěr</div>
    <div class="finale-h">Kde končí<br>fyzika</div>
    <p class="finale-body">Černé díry jsou oknami do oblastí, kde se kvantová mechanika střetává s relativitou. Odpovědi na jejich záhady možná povedou k <strong>Teorii Všeho</strong>.</p>
   </div>
   <svg style="position:absolute;inset:0;pointer-events:none;" width="100%" height="100%" viewBox="0 0 1200 700" preserveAspectRatio="xMidYMid slice">
    <defs><radialGradient id="fg" cx="50%" cy="50%"><stop offset="0%" stop-color="#c44bff" stop-opacity="0.12"/><stop offset="100%" stop-color="transparent"/></radialGradient></defs>
    <ellipse cx="600" cy="350" rx="380" ry="380" fill="url(#fg)"/>
    <circle cx="600" cy="350" r="170" fill="none" stroke="rgba(196,75,255,0.08)" stroke-width="1" style="animation:pulse 3s ease-in-out infinite;transform-origin:600px 350px;"/>
    <circle cx="600" cy="350" r="210" fill="none" stroke="rgba(255,107,53,0.06)" stroke-width="1" style="animation:pulse 4s 1s ease-in-out infinite;transform-origin:600px 350px;"/>
   </svg>
  </div>

 </div>

 <!-- NAV -->
 <nav class="nav-bar">
 <div class="nav-dots" id="navDots"></div>
  <div class="nav-btns">
   <div class="nav-main-btns">
    <button id="prevBtn" class="nav-btn" onclick="go(-1)">← Zpět</button>
    <button id="nextBtn" class="nav-btn" onclick="go(1)">Dál →</button>
   </div>
   <div class="music-controls">
    <div class="music-row">
      <button id="trackPrevBtn" class="music-btn" type="button" aria-label="Previous track">◀◀</button>
      <button id="audioPlayPauseBtn" class="music-btn music-play" type="button" aria-pressed="true">Pause</button>
      <button id="trackNextBtn" class="music-btn" type="button" aria-label="Next track">▶▶</button>
      <div id="musicTrackLabel" class="music-track">Track 1/2</div>
      <input id="audioSeek" class="music-seek" type="range" min="0" max="100" value="0" step="0.1" aria-label="Seek">
      <input id="audioVolume" class="music-volume" type="range" min="0" max="1" value="0.24" step="0.01" aria-label="Volume">
    </div>
   </div>
  </div>
  <div class="slide-counter" id="counter">01 / 09</div>
 </nav>
</div>

<section id="aboutSection" class="about-section">
  <div id="aboutWrap" class="about-wrap">
    <h2 id="aboutTitle" class="about-title">About This Template</h2>
    <p id="aboutBody" class="about-body">
      This page includes a reusable blueprint for cinematic AI-generated presentations. It is built to stay topic-agnostic while preserving this visual quality, pacing, and interaction style.
    </p>
    <div class="about-actions">
      <div class="about-card">
        <h3 id="humanTitle">Are you human?</h3>
        <p id="humanBody">Use ready-to-use files and generate a similar presentation quickly with minimal prompting.</p>
        <a id="downloadPromptBtn" class="about-btn" href="#" download>Download BlackHoleEdu (Offline ZIP)</a>
      </div>
    </div>
    <div id="aboutFooter" class="about-footer">
      Copyright © 2026 - Made with ♥ by <a href="https://github.com/DrokRhys" target="_blank" rel="noopener noreferrer">Drok Rhys</a> at <a href="https://magiostudios.com" target="_blank" rel="noopener noreferrer">Magio Studios</a>. Join the community on <a href="https://patreon.com/magiostudios" target="_blank" rel="noopener noreferrer">Patreon</a>.
    </div>
  </div>
</section>

<script>
const slidePhoto = document.getElementById('slidePhoto');
const slidePhotoPanel = document.querySelector('.slide-photo-panel');
const backHomeLink = document.getElementById('backHomeLink');
const aboutLink = document.getElementById('aboutLink');
const aboutSection = document.getElementById('aboutSection');
const aboutWrap = document.getElementById('aboutWrap');
const aboutTitle = document.getElementById('aboutTitle');
const aboutBody = document.getElementById('aboutBody');
const downloadPromptBtn = document.getElementById('downloadPromptBtn');
const humanTitle = document.getElementById('humanTitle');
const humanBody = document.getElementById('humanBody');
const aboutFooter = document.getElementById('aboutFooter');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const audioPlayPauseBtn = document.getElementById('audioPlayPauseBtn');
const trackPrevBtn = document.getElementById('trackPrevBtn');
const trackNextBtn = document.getElementById('trackNextBtn');
const audioSeek = document.getElementById('audioSeek');
const audioVolume = document.getElementById('audioVolume');
const musicTrackLabel = document.getElementById('musicTrackLabel');
const langCsBtn = document.getElementById('langCsBtn');
const langEnBtn = document.getElementById('langEnBtn');
const canvasACaption = document.getElementById('canvasACaption');
const canvasBCaption = document.getElementById('canvasBCaption');
const btnModelA = document.getElementById('btnModelA');
const btnModelB = document.getElementById('btnModelB');
const philoQuoteText = document.getElementById('philoQuoteText');
const philoQuoteSrc = document.getElementById('philoQuoteSrc');
const urlParams = new URLSearchParams(window.location.search);
const storedLang = localStorage.getItem('magio-language');
const paramLang = urlParams.get('lang');
const pageLang = paramLang === 'en' || paramLang === 'cs'
  ? paramLang
  : (storedLang === 'en' ? 'en' : 'cs');
const uiText = {
  cs: {
    backHome: '← Zpět na homepage',
    prev: '← Zpět',
    next: 'Dál →',
    play: 'Play',
    pause: 'Pause',
    track: 'Skladba',
    densityAdd: '+ PŘIDAT',
    densityRemove: '− ODEBRAT',
    clickCanvas: 'klikni na canvas',
    clickAddMass: 'klikni — přidej hmotu',
    simFast: '● rychlé interakce',
    simSlow: '● zpomalené interakce',
    simAdd: '⊕ klikni = přidej hmotu',
    simSparse: '● řídká oblast — rychlé interakce',
    simDense: '● hustá oblast — pomalé interakce',
    simAddWithCount: '⊕ klikni = přidej hmotu',
    particles: 'částic',
    massLabel: 'HMOTA',
    interactionDown: 'interakce ↓',
    philoQuoteText: 'Velké množství hmoty si navzájem zpomaluje vlastní existenci. Čas není absolutní — je to tempo,<br>kterým věci reagují.',
    aboutNav: 'About',
    aboutTitle: 'O Šabloně',
    aboutBody: 'Tahle šablona je pro volné použití: můžeš ji použít pro libovolné téma prezentace a upravit podle sebe.',
    downloadPrompt: 'Stáhnout BlackHoleEdu (Offline ZIP)',
    humanTitle: 'Jsi člověk?',
    humanBody: 'Stáhni si kompletní offline verzi stránky BlackHoleEdu včetně assetů.',
    footerHtml: 'Copyright © 2026 - Made with ♥ by <a href="https://github.com/DrokRhys" target="_blank" rel="noopener noreferrer">Drok Rhys</a> at <a href="https://magiostudios.com" target="_blank" rel="noopener noreferrer">Magio Studios</a>. Join the community on <a href="https://patreon.com/magiostudios" target="_blank" rel="noopener noreferrer">Patreon</a>.<br>Tato šablona je poskytována pro volné použití pod licencí MIT. Každou prezentaci můžeš použít a upravit podle sebe. Offline verze funguje bez internetu: stáhni ZIP, rozbal ho a otevři <code>index.html</code> v prohlížeči (pokud se hudba nespustí sama, klikni na Play). Hudba byla vytvořena v Suno (Pro účet); použití je vázáno na podmínky Suno. Zdroje obrázků jsou uvedené v <a href="./images/slides/README.md" target="_blank" rel="noopener noreferrer">README</a> (NASA/ESA/open sources).',
  },
  en: {
    backHome: '← Back to Homepage',
    prev: '← Previous',
    next: 'Next →',
    play: 'Play',
    pause: 'Pause',
    track: 'Track',
    densityAdd: '+ ADD',
    densityRemove: '− REMOVE',
    clickCanvas: 'click on canvas',
    clickAddMass: 'click — add mass',
    simFast: '● fast interactions',
    simSlow: '● slowed interactions',
    simAdd: '⊕ click = add mass',
    simSparse: '● sparse region — fast interactions',
    simDense: '● dense region — slow interactions',
    simAddWithCount: '⊕ click = add mass',
    particles: 'particles',
    massLabel: 'MASS',
    interactionDown: 'interaction ↓',
    philoQuoteText: 'Large concentrations of mass slow down interactions. Time is not absolute — it is the pace at which processes respond.',
    aboutNav: 'About',
    aboutTitle: 'About This Template',
    aboutBody: 'This template is for free use: you can adapt it to any presentation topic and modify it as needed.',
    downloadPrompt: 'Download BlackHoleEdu (Offline ZIP)',
    humanTitle: 'Are you human?',
    humanBody: 'Download the complete offline BlackHoleEdu page with all assets.',
    footerHtml: 'Copyright © 2026 - Made with ♥ by <a href="https://github.com/DrokRhys" target="_blank" rel="noopener noreferrer">Drok Rhys</a> at <a href="https://magiostudios.com" target="_blank" rel="noopener noreferrer">Magio Studios</a>. Join the community on <a href="https://patreon.com/magiostudios" target="_blank" rel="noopener noreferrer">Patreon</a>.<br>This template is provided for free use under the MIT License. You may use and modify any presentation made with it. Offline mode works without internet: download the ZIP, extract it, then open <code>index.html</code> in your browser (if audio does not start automatically, click Play). Music was generated with Suno (Pro account); usage remains subject to Suno Terms. Image sources are listed in the <a href="./images/slides/README.md" target="_blank" rel="noopener noreferrer">README</a> (NASA/ESA/open sources).',
  },
};

function setNodeHTML(root, selector, value, index = 0) {
  if (!root) return;
  const nodes = root.querySelectorAll(selector);
  const node = nodes[index];
  if (node && typeof value === 'string') node.innerHTML = value;
}

function replaceExactText(root, replacements) {
  if (!root) return;
  const walker = document.createTreeWalker(root, NodeFilter.SHOW_TEXT);
  let node = walker.nextNode();
  while (node) {
    const raw = node.nodeValue || '';
    const trimmed = raw.trim();
    if (trimmed && Object.prototype.hasOwnProperty.call(replacements, trimmed)) {
      const leading = raw.match(/^\s*/)?.[0] || '';
      const trailing = raw.match(/\s*$/)?.[0] || '';
      node.nodeValue = `${leading}${replacements[trimmed]}${trailing}`;
    }
    node = walker.nextNode();
  }
}

function applyPresentationLanguage(lang) {
  if (lang !== 'en') return;
  document.title = 'BLACK HOLES';
  const slides = document.querySelectorAll('.slide');
  replaceExactText(document.body, {
    'Schwarzschildův': 'Schwarzschild',
    'poloměr': 'radius',
    'fotonová sféra': 'photon sphere',
    'Horizont událostí': 'Event horizon',
    'Relativistický jet': 'Relativistic jet',
    'Akreční disk': 'Accretion disk',
    'stejné měřítko': 'same scale',
    '13 864× menší': '13,864× smaller',
    '74× menší': '74× smaller',
    '295 mil. km (= 424× Slunce)': '295M km (= 424× Sun)',
    'BLÍZKO BH': 'NEAR BH',
    '6× pomalejší čas': '6× slower time',
    'Titulky': 'Captions',
    '⚡ Rychlý fakt': '⚡ Quick fact',
    'Sgr A* — černá díra v centru Mléčné dráhy — má hmotnost 4 milionů Sluncí.': 'Sgr A* — the black hole at the center of the Milky Way — has about 4 million solar masses.',
    'GPS SATELITY': 'GPS SATELLITES',
    'PŘÍZEMÍ VS. HORA': 'GROUND FLOOR VS. MOUNTAIN',
    'HORIZONT UDÁLOSTÍ': 'EVENT HORIZON',
    'Bez korekce dilatace by se GPS mýlilo o 11 km/den': 'Without relativistic correction, GPS would drift by about 11 km/day.',
    'Hodiny v přízemí tikají o 45 ns/den pomaleji než na vrcholu Everestu': 'Clocks near sea level tick about 45 ns/day slower than at Everest summit.',
    'Na horizontu se interakce zastaví úplně — čas se pro vnějšího pozorovatele zastaví': 'At the horizon, interactions effectively freeze for a distant observer.',
    'Velké množství hmoty si navzájem zpomaluje vlastní existenci. Čas není absolutní — je to tempo, kterým věci reagují.': 'Large concentrations of mass slow down interactions. Time is not absolute — it is the pace at which processes respond.',
  });

  // Slide 1
  setNodeHTML(slides[0], '.hero-eyebrow', '01 · Intro');
  setNodeHTML(slides[0], '.hero-title', 'BLACK<br><span class="outline">HOLES</span>');
  setNodeHTML(slides[0], '.hero-sub', 'Where the laws of physics break down');

  // Slide 2
  setNodeHTML(slides[1], '.slide-label', '02 · Definition');
  setNodeHTML(slides[1], '.slide-heading', 'What is a<br>black hole?');
  setNodeHTML(slides[1], '.slide-body', 'A region of space where <strong>gravity is so strong</strong> that nothing, not even light, can escape. It forms after the collapse of a <strong>massive star</strong>.', 0);
  setNodeHTML(slides[1], '.slide-body', 'The boundary beyond which there is no return is called the <strong>event horizon</strong>. It is not a physical wall, but a mathematical boundary of spacetime.', 1);
  setNodeHTML(slides[1], '.fact-label', '⚡ Quick fact');

  // Slide 3
  setNodeHTML(slides[2], '.slide-label', '03 · Anatomy');
  setNodeHTML(slides[2], '.slide-heading', 'Internal<br>structure');
  setNodeHTML(slides[2], '.anat-info p', 'A point of infinite density at the center. Physics breaks down and spacetime bends to extremes.', 0);
  setNodeHTML(slides[2], '.anat-info p', 'A one-way boundary of spacetime. You can cross it only inward.', 1);
  setNodeHTML(slides[2], '.anat-info p', 'A superheated spiral of gas falling inward, glowing in X-rays.', 2);
  setNodeHTML(slides[2], '.anat-info p', 'Plasma beams launched from poles at near-light speed over thousands of light-years.', 3);
  setNodeHTML(slides[2], '.anat-info h4', 'Singularity', 0);
  setNodeHTML(slides[2], '.anat-info h4', 'Event horizon', 1);
  setNodeHTML(slides[2], '.anat-info h4', 'Accretion disk', 2);
  setNodeHTML(slides[2], '.anat-info h4', 'Relativistic jets', 3);

  // Slide 4
  setNodeHTML(slides[3], '.slide-label', '04 · Philosophy');
  setNodeHTML(slides[3], '.slide-heading', 'Mass slows<br>time');
  setNodeHTML(slides[3], '.slide-body', 'Time dilation is not magic. It is a <strong>natural consequence of density</strong>. The more mass concentrated in one region, the slower interactions become.', 0);
  setNodeHTML(slides[3], '.slide-body', 'Clocks do not tick because of a mechanism alone, but because of <strong>electromagnetic interactions</strong> between atoms. In strong gravity, these interactions slow down.', 1);
  setNodeHTML(slides[3], '.quote-text', 'Large concentrations of mass slow down interactions. Time is not absolute — it is the pace at which processes respond.');
  if (philoQuoteSrc) philoQuoteSrc.innerHTML = '— physical interpretation of general relativity';
  setNodeHTML(slides[3], 'div[style*="GPS SATELITY"]', 'GPS SATELLITES');
  setNodeHTML(slides[3], 'div[style*="PŘÍZEMÍ VS. HORA"]', 'GROUND FLOOR VS. MOUNTAIN');
  setNodeHTML(slides[3], 'div[style*="HORIZONT UDÁLOSTÍ"]', 'EVENT HORIZON');

  // Slide 5
  setNodeHTML(slides[4], '.slide-label', '05 · Classification');
  setNodeHTML(slides[4], '.slide-heading', 'Types of black holes');
  setNodeHTML(slides[4], '.type-unit', 'solar masses · midpoint 17 M☉', 0);
  setNodeHTML(slides[4], '.type-unit', 'solar masses · midpoint 3,162 M☉', 1);
  setNodeHTML(slides[4], '.type-unit', 'solar masses · midpoint 10⁸ M☉', 2);
  setNodeHTML(slides[4], '.type-name', 'Stellar', 0);
  setNodeHTML(slides[4], '.type-name', 'Intermediate', 1);
  setNodeHTML(slides[4], '.type-name', 'Supermassive', 2);
  setNodeHTML(slides[4], '.type-desc', 'Formed by massive star collapse. Radius only <strong style="color:#5bb4ff;">~50 km</strong> — smaller than a city. The Sun is roughly 14,000× larger.', 0);
  setNodeHTML(slides[4], '.type-desc', 'A mysterious middle class. Radius <strong style="color:#c44bff;">~9,300 km</strong> — about Earth-size diameter. The Sun is still 74× larger.', 1);
  setNodeHTML(slides[4], '.type-desc', 'Giants in galactic centers. Radius <strong style="color:#ff6b35;">295 million km</strong> — about 2× Earth–Sun distance. Could swallow most of a solar system.', 2);

  // Slide 6
  setNodeHTML(slides[5], '.slide-label', '06 · Spaghettification');
  setNodeHTML(slides[5], '.slide-heading', 'Spaghettification<br>effect');
  setNodeHTML(slides[5], '.slide-body', 'As an object approaches the horizon, the <strong>gravitational gradient</strong> between its near and far sides rises rapidly. The body is <strong>stretched like spaghetti</strong> along the fall direction.', 0);
  setNodeHTML(slides[5], '.big-stat-lbl', 'Newton/kg — tidal forces near a stellar black hole');
  setNodeHTML(slides[5], '.slide-body', 'For <strong>supermassive</strong> black holes, this effect can be weaker at the horizon because the gradient there is smaller. Crossing the horizon might not be instantly lethal.', 1);

  // Slide 7
  setNodeHTML(slides[6], '.slide-label', '07 · Relativity');
  setNodeHTML(slides[6], '.slide-heading', 'Time<br>dilation');
  setNodeHTML(slides[6], '.slide-body', 'The stronger the gravity, the <strong>slower time flows</strong>. Clocks near the horizon appear almost frozen to a distant observer — a key effect of <strong>general relativity</strong>.', 0);
  setNodeHTML(slides[6], '.slide-body', 'An astronaut falling in notices nothing special locally. For an outside observer, they seem to freeze just before the horizon.', 1);
  setNodeHTML(slides[6], '.quote-src', '— Interstellar · physics basis: Kip Thorne');

  // Slide 8
  setNodeHTML(slides[7], '.slide-label', '08 · Quantum physics');
  setNodeHTML(slides[7], '.slide-heading', 'Hawking radiation');
  setNodeHTML(slides[7], '.slide-body', 'In 1974, Stephen Hawking predicted that quantum fluctuations near the horizon allow particles to escape. A black hole can therefore slowly <strong>evaporate</strong>.');
  setNodeHTML(slides[7], '.hawk-item h4', 'Virtual pairs', 0);
  setNodeHTML(slides[7], '.hawk-item h4', 'Radiation temperature', 1);
  setNodeHTML(slides[7], '.hawk-item h4', 'Evaporation', 2);
  setNodeHTML(slides[7], '.hawk-item p', 'Near the horizon, particle–antiparticle pairs appear. One falls in, one escapes as radiation.', 0);
  setNodeHTML(slides[7], '.hawk-item p', 'The smaller the black hole, the hotter the radiation. Stellar black holes are extremely cold.', 1);
  setNodeHTML(slides[7], '.hawk-item p', 'A solar-mass black hole would evaporate over an enormously long timescale.', 2);

  // Slide 9
  setNodeHTML(slides[8], '.finale-tag', '09 · Conclusion');
  setNodeHTML(slides[8], '.finale-h', 'Where<br>physics ends');
  setNodeHTML(slides[8], '.finale-body', 'Black holes are windows into domains where quantum mechanics meets relativity. Answers to their mysteries may lead toward a deeper unified theory.');
}
const slidePhotoUrls = [
  '',
  './images/slides/slide-02.jpg',
  './images/slides/slide-03.jpg',
  './images/slides/slide-04.jpg',
  './images/slides/slide-05.jpg',
  './images/slides/slide-06.jpg',
  './images/slides/slide-07.jpg',
  './images/slides/slide-08.jpg',
  './images/slides/slide-09.jpg',
];
const slidePhotoFallbackArt = './images/slides/slide-fallback.jpg';

if (backHomeLink) {
  backHomeLink.textContent = uiText[pageLang].backHome;
  backHomeLink.href = `/?lang=${pageLang}`;
  backHomeLink.addEventListener('click', () => {
    localStorage.setItem('magio-language', pageLang);
  });
}
if (aboutLink) {
  aboutLink.textContent = uiText[pageLang].aboutNav;
  aboutLink.addEventListener('click', (e) => {
    e.preventDefault();
    if (aboutSection) {
      aboutSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
  });
}
if (aboutTitle) aboutTitle.textContent = uiText[pageLang].aboutTitle;
if (aboutBody) aboutBody.textContent = uiText[pageLang].aboutBody;
if (downloadPromptBtn) downloadPromptBtn.textContent = uiText[pageLang].downloadPrompt;
if (humanTitle) humanTitle.textContent = uiText[pageLang].humanTitle;
if (humanBody) humanBody.textContent = uiText[pageLang].humanBody;
if (aboutFooter) aboutFooter.innerHTML = uiText[pageLang].footerHtml;
if (langCsBtn && langEnBtn) {
  const setActive = () => {
    langCsBtn.classList.toggle('active', pageLang === 'cs');
    langEnBtn.classList.toggle('active', pageLang === 'en');
  };
  setActive();
  langCsBtn.addEventListener('click', () => {
    localStorage.setItem('magio-language', 'cs');
    window.location.search = '?lang=cs';
  });
  langEnBtn.addEventListener('click', () => {
    localStorage.setItem('magio-language', 'en');
    window.location.search = '?lang=en';
  });
}
applyPresentationLanguage(pageLang);
if (prevBtn) prevBtn.textContent = uiText[pageLang].prev;
if (nextBtn) nextBtn.textContent = uiText[pageLang].next;
if (canvasACaption) canvasACaption.textContent = uiText[pageLang].clickAddMass;
if (canvasBCaption) canvasBCaption.textContent = uiText[pageLang].clickCanvas;
if (btnModelA) btnModelA.textContent = pageLang === 'en' ? 'EXTERNAL MASS' : 'VNĚJŠÍ HMOTA';
if (btnModelB) btnModelB.textContent = pageLang === 'en' ? 'PARTICLE DENSITY' : 'HUSTOTA ČÁSTIC';
if (philoQuoteText) philoQuoteText.innerHTML = uiText[pageLang].philoQuoteText;

if (aboutSection && aboutWrap) {
  const aboutObserver = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        aboutWrap.classList.add('is-visible');
      }
    });
  }, { threshold: 0.2 });
  aboutObserver.observe(aboutSection);
}

function applySlidePhoto(url) {
  if (!slidePhoto || !url) return;
  if (slidePhoto.dataset.current === url) return;
  slidePhoto.classList.add('is-loading');
  slidePhoto.dataset.current = url;
  slidePhoto.src = url;
}

function setSlidePhoto(slideIndex) {
  if (!slidePhoto) return;
  if (slideIndex === 0) {
    if (slidePhotoPanel) slidePhotoPanel.classList.add('is-disabled');
    return;
  }
  if (slidePhotoPanel) slidePhotoPanel.classList.remove('is-disabled');
  const url = slidePhotoUrls[slideIndex] || slidePhotoFallbackArt;
  applySlidePhoto(url);
}

if (slidePhoto) {
  slidePhoto.addEventListener('load', () => {
    slidePhoto.classList.remove('is-loading');
  });
  slidePhoto.addEventListener('error', () => {
    if (slidePhoto.dataset.current !== slidePhotoFallbackArt) {
      applySlidePhoto(slidePhotoFallbackArt);
    }
  });
  setSlidePhoto(0);
}

const ambientTracks = [
  new Audio('./ambient-2.mp3'),
  new Audio('./ambient-1.mp3'),
];
let ambientTrackIndex = 0;
let ambientEnabled = true;
let hasBootStartedTrack = false;
let ambientVolume = 0.24;

ambientTracks.forEach((track) => {
  track.preload = 'auto';
  track.volume = ambientVolume;
  track.playsInline = true;
});
if (audioVolume) audioVolume.value = String(ambientVolume);

function getCurrentTrack() {
  return ambientTracks[ambientTrackIndex];
}

function updateMusicUI() {
  if (audioPlayPauseBtn) {
    audioPlayPauseBtn.textContent = ambientEnabled ? uiText[pageLang].pause : uiText[pageLang].play;
    audioPlayPauseBtn.setAttribute('aria-pressed', ambientEnabled ? 'true' : 'false');
  }
  if (musicTrackLabel) {
    musicTrackLabel.textContent = `${uiText[pageLang].track} ${ambientTrackIndex + 1}/${ambientTracks.length}`;
  }
  const current = getCurrentTrack();
  if (audioSeek && current && Number.isFinite(current.duration) && current.duration > 0) {
    audioSeek.max = String(current.duration);
    audioSeek.value = String(current.currentTime || 0);
  }
}

function syncSeek() {
  const current = getCurrentTrack();
  if (!audioSeek || !current) return;
  if (Number.isFinite(current.duration) && current.duration > 0) {
    audioSeek.max = String(current.duration);
    audioSeek.value = String(current.currentTime || 0);
  }
}

async function playAmbientTrack(restart = false) {
  const track = getCurrentTrack();
  if (!track) return;
  if (restart) {
    const shouldStartOffset = ambientTrackIndex === 0 && !hasBootStartedTrack;
    if (shouldStartOffset) {
      if (Number.isFinite(track.duration) && track.duration > 0) {
        track.currentTime = track.duration / 2;
        hasBootStartedTrack = true;
      } else {
        const onMeta = () => {
          track.currentTime = track.duration > 0 ? track.duration / 2 : 0;
          hasBootStartedTrack = true;
          track.removeEventListener('loadedmetadata', onMeta);
        };
        track.addEventListener('loadedmetadata', onMeta);
        track.currentTime = 0;
      }
    } else {
      track.currentTime = 0;
    }
  }
  await track.play();
}

function pauseAmbient() {
  const track = getCurrentTrack();
  if (track) track.pause();
}

async function setAmbient(enabled, restart = false) {
  ambientEnabled = enabled;
  if (!ambientEnabled) {
    pauseAmbient();
    updateMusicUI();
    return;
  }

  // Ensure sound is enabled for normal playback attempts.
  ambientTracks.forEach((track) => {
    track.muted = false;
    track.volume = ambientVolume;
  });

  try {
    await playAmbientTrack(restart);
  } catch (_) {
    // Autoplay can be blocked until first user interaction.
    // Reflect real state in UI (show Play).
    ambientEnabled = false;
  }
  updateMusicUI();
}

ambientTracks.forEach((track, index) => {
  track.addEventListener('timeupdate', syncSeek);
  track.addEventListener('loadedmetadata', syncSeek);
  track.addEventListener('ended', async () => {
    if (!ambientEnabled) return;
    ambientTrackIndex = (index + 1) % ambientTracks.length;
    try {
      await playAmbientTrack(true);
    } catch (_) {
      ambientEnabled = false;
      updateMusicUI();
    }
    updateMusicUI();
  });
});

if (audioPlayPauseBtn) {
  audioPlayPauseBtn.addEventListener('click', () => {
    const current = getCurrentTrack();
    const isActuallyPlaying = current ? !current.paused : false;
    setAmbient(!isActuallyPlaying, false);
  });
}
if (trackPrevBtn) {
  trackPrevBtn.addEventListener('click', async () => {
    ambientTrackIndex = (ambientTrackIndex - 1 + ambientTracks.length) % ambientTracks.length;
    ambientTracks.forEach((track, i) => {
      if (i !== ambientTrackIndex) track.pause();
    });
    if (ambientEnabled) {
      await setAmbient(true, true);
    } else {
      syncSeek();
      updateMusicUI();
    }
  });
}
if (trackNextBtn) {
  trackNextBtn.addEventListener('click', async () => {
    ambientTrackIndex = (ambientTrackIndex + 1) % ambientTracks.length;
    ambientTracks.forEach((track, i) => {
      if (i !== ambientTrackIndex) track.pause();
    });
    if (ambientEnabled) {
      await setAmbient(true, true);
    } else {
      syncSeek();
      updateMusicUI();
    }
  });
}
if (audioSeek) {
  audioSeek.addEventListener('input', () => {
    const current = getCurrentTrack();
    if (!current) return;
    const value = Number(audioSeek.value);
    if (!Number.isFinite(value)) return;
    current.currentTime = value;
  });
}
if (audioVolume) {
  audioVolume.addEventListener('input', () => {
    const value = Number(audioVolume.value);
    if (!Number.isFinite(value)) return;
    ambientVolume = Math.max(0, Math.min(1, value));
    ambientTracks.forEach((track) => {
      track.volume = ambientVolume;
    });
  });
}
updateMusicUI();
async function attemptAutoplayOnLoad() {
  await setAmbient(true, true);
}
attemptAutoplayOnLoad();

const bootstrapAmbientOnInteraction = () => {
  setAmbient(true, false);
  window.removeEventListener('pointerdown', bootstrapAmbientOnInteraction);
  window.removeEventListener('keydown', bootstrapAmbientOnInteraction);
  window.removeEventListener('touchstart', bootstrapAmbientOnInteraction);
};
window.addEventListener('pointerdown', bootstrapAmbientOnInteraction, { once: true });
window.addEventListener('keydown', bootstrapAmbientOnInteraction, { once: true });
window.addEventListener('touchstart', bootstrapAmbientOnInteraction, { once: true });

// STARFIELD
const cvs = document.getElementById('starfield');
const ctx = cvs.getContext('2d');
let sbg = [];
function resize(){ cvs.width=innerWidth; cvs.height=innerHeight; }
function initS(){ sbg=[]; for(let i=0;i<280;i++) sbg.push({x:Math.random()*cvs.width,y:Math.random()*cvs.height,r:Math.random()*1.4+.2,a:Math.random(),sp:Math.random()*.0008+.0002,ph:Math.random()*Math.PI*2}); }
function drawS(){ ctx.clearRect(0,0,cvs.width,cvs.height); const t=Date.now()*.001; for(let s of sbg){ const al=(Math.sin(t*s.sp*1000+s.ph)*.3+.7)*s.a; ctx.beginPath(); ctx.arc(s.x,s.y,s.r,0,Math.PI*2); ctx.fillStyle=`rgba(232,213,163,${al*.55})`; ctx.fill(); } requestAnimationFrame(drawS); }
resize(); initS(); drawS();
window.addEventListener('resize',()=>{ resize(); initS(); });

// CURSOR
const cur=document.getElementById('cursor'),ring=document.getElementById('cursorRing');
let mx=0,my=0,rx=0,ry=0;
document.addEventListener('mousemove',e=>{ mx=e.clientX; my=e.clientY; cur.style.left=mx+'px'; cur.style.top=my+'px'; });
(function anim(){ rx+=(mx-rx)*.12; ry+=(my-ry)*.12; ring.style.left=rx+'px'; ring.style.top=ry+'px'; requestAnimationFrame(anim); })();

// SLIDES
const slides=document.querySelectorAll('.slide');
let cur_i=0, busy=false;

function buildDots(){ const el=document.getElementById('navDots'); el.innerHTML=''; slides.forEach((_,i)=>{ const d=document.createElement('div'); d.className='nav-dot'+(i===0?' active':''); d.onclick=()=>gotoSlide(i); el.appendChild(d); }); }
function updNav(){ document.querySelectorAll('.nav-dot').forEach((d,i)=>d.classList.toggle('active',i===cur_i)); document.getElementById('counter').textContent=String(cur_i+1).padStart(2,'0')+' / '+String(slides.length).padStart(2,'0'); }

function gotoSlide(idx){
 if(busy||idx===cur_i||idx<0||idx>=slides.length) return;
 busy=true;
 const dir=idx>cur_i?1:-1;
 const old=slides[cur_i], nw=slides[idx];
 old.classList.add(dir>0?'exit-left':'exit-right');
 old.classList.remove('active');
 nw.style.opacity='0';
 nw.classList.add('active');
 nw.classList.add(dir>0?'enter-right':'enter-left');
 setTimeout(()=>{ old.classList.remove('exit-left','exit-right'); nw.classList.remove('enter-right','enter-left'); nw.style.opacity=''; cur_i=idx; busy=false; updNav(); onEnter(cur_i); },720);
}

function go(d){ gotoSlide(cur_i+d); }

// ══════════════════════════════════════════════
// PARTICLE TIME DILATION SIMULATION
// ══════════════════════════════════════════════
const PHILO_SLIDE = 3; // 0-indexed slide number for philosophy slide

class ParticleSim {
  constructor(canvas) {
    this.c = canvas;
    this.x = canvas.getContext('2d');
    this.W = canvas.width;
    this.H = canvas.height;
    this.pts = [];
    this.wells = [];
    this.running = false;
    this.raf = null;
    this.init();
    this.bind();
  }

  init() {
    this.pts = [];
    // Denser grid — 14×11 = 154 particles
    const cols = 14, rows = 11;
    const padX = 22, padY = 22;
    const stepX = (this.W - padX*2) / (cols-1);
    const stepY = (this.H - padY*2) / (rows-1);
    for(let r=0; r<rows; r++){
      for(let c=0; c<cols; c++){
        const jx = (Math.random()-.5)*stepX*0.28;
        const jy = (Math.random()-.5)*stepY*0.28;
        this.pts.push({
          x: padX + c*stepX + jx,
          y: padY + r*stepY + jy,
          vx: (Math.random()-.5)*0.12,
          vy: (Math.random()-.5)*0.12,
          r: 1.4 + Math.random()*0.7,  // much smaller particles
          tf: 1,
          signals: []
        });
      }
    }
    this.wells = [];
    this.buildBonds();
  }

  buildBonds() {
    // Dynamic — called every frame, not at init
    // Just initializes the bonds array
    this.bonds = [];
  }

  rebuildBonds() {
    const MAX_DIST = 46;
    // Keep existing bonds that are still in range, add new ones, remove old ones
    // For efficiency: rebuild fully each frame (154 particles = ~11k checks, fine)
    const newBonds = [];
    const existing = new Map();
    for(const b of this.bonds){
      existing.set(`${b.i}_${b.j}`, b);
    }

    for(let i=0; i<this.pts.length; i++){
      const a = this.pts[i];
      for(let j=i+1; j<this.pts.length; j++){
        const b = this.pts[j];
        const d = Math.hypot(a.x-b.x, a.y-b.y);
        if(d < MAX_DIST){
          const key = `${i}_${j}`;
          if(existing.has(key)){
            // preserve existing bond with its signals and timer
            newBonds.push(existing.get(key));
          } else {
            // new bond — stagger initial signal
            newBonds.push({ i, j, signals: [], nextSignal: 20 + Math.random()*50 });
          }
        }
        // bonds outside MAX_DIST are simply dropped (signals lost)
      }
    }
    this.bonds = newBonds;
  }

  mkP() { return null; }

  addWell(x, y) {
    if (this.wells.length >= 6) this.wells.shift();
    this.wells.push({ x, y, mass: 0, born: Date.now(), life: 11000, fade: 0 });
  }

  bind() {
    const c = this.c;
    const pos = e => {
      const r = c.getBoundingClientRect();
      const sx = this.W/r.width, sy = this.H/r.height;
      const src = e.touches ? e.touches[0] : e;
      return { x: (src.clientX-r.left)*sx, y: (src.clientY-r.top)*sy };
    };
    c.addEventListener('mousedown', e => { const p=pos(e); this.addWell(p.x,p.y); });
    c.addEventListener('touchstart', e => { e.preventDefault(); const p=pos(e); this.addWell(p.x,p.y); }, {passive:false});
  }

  getFieldTF(x, y) {
    // Time dilation at a spatial point — additive across all wells
    let potential = 0;
    for(const w of this.wells){
      const d = Math.max(Math.hypot(x-w.x, y-w.y), 16);
      potential += (w.mass * w.fade) / d;
    }
    return Math.max(0.04, 1 / (1 + potential * 0.009));
  }

  getTF(p) { return this.getFieldTF(p.x, p.y); }

  update() {
    const now = Date.now();

    // Rebuild bonds dynamically based on current particle positions
    this.rebuildBonds();

    // Update wells
    for(let i=this.wells.length-1; i>=0; i--){
      const w = this.wells[i];
      const age = now - w.born;
      const rem = w.life - age;
      w.fade = age < 700 ? age/700 : (rem < 1500 ? rem/1500 : 1);
      w.mass = w.fade * 2400;
      if(age > w.life) this.wells.splice(i,1);
    }

    // Update particle tf and slow drift
    for(const p of this.pts){
      p.tf = this.getTF(p);
      // gentle drift scaled by tf
      p.x += p.vx * p.tf;
      p.y += p.vy * p.tf;
      // soft bounce
      if(p.x < 20 || p.x > this.W-20) p.vx *= -1;
      if(p.y < 20 || p.y > this.H-20) p.vy *= -1;
      p.x = Math.max(10, Math.min(this.W-10, p.x));
      p.y = Math.max(10, Math.min(this.H-10, p.y));
    }

    // Update bonds and their traveling signals
    for(const bond of this.bonds){
      const a = this.pts[bond.i];
      const b = this.pts[bond.j];
      // average tf along the bond (sample midpoint)
      const mx = (a.x+b.x)/2, my = (a.y+b.y)/2;
      const bondTF = this.getFieldTF(mx, my);

      // Countdown to next signal emission — slower when dilated
      bond.nextSignal -= bondTF;
      if(bond.nextSignal <= 0){
        // emit a signal traveling from i→j or j→i alternately
        bond.signals.push({ t: 0, dir: Math.random() < 0.5 ? 1 : -1 });
        bond.nextSignal = 50 + Math.random()*70;
      }

      // Advance signals — speed proportional to tf at current position
      for(let s=bond.signals.length-1; s>=0; s--){
        const sig = bond.signals[s];
        // interpolate position to find tf at signal location
        const sigX = a.x + (b.x-a.x)*sig.t;
        const sigY = a.y + (b.y-a.y)*sig.t;
        const sigTF = this.getFieldTF(sigX, sigY);
        // signal travels at speed proportional to local tf
        sig.t += sig.dir * sigTF * 0.022;
        if(sig.t > 1 || sig.t < 0) bond.signals.splice(s,1);
      }
    }
  }

  draw() {
    const ctx=this.x, W=this.W, H=this.H;
    ctx.clearRect(0,0,W,H);

    // BG
    ctx.fillStyle='rgba(5,3,18,1)';
    ctx.fillRect(0,0,W,H);

    // Space fabric grid — distorted by wells
    const sp = 34;
    for(let gx=sp/2; gx<W; gx+=sp){
      for(let gy=sp/2; gy<H; gy+=sp){
        let dxt=0, dyt=0;
        for(const w of this.wells){
          const dx=gx-w.x, dy=gy-w.y;
          const d=Math.sqrt(dx*dx+dy*dy)+1;
          const pull=(w.mass*w.fade*0.55)/(d*d+120);
          dxt-=dx/d*pull; dyt-=dy/d*pull;
        }
        const distort=Math.sqrt(dxt*dxt+dyt*dyt);
        // color: purple near wells, dim blue elsewhere
        const h = distort>3 ? 275 : 230;
        const al = Math.min(0.28, 0.03+distort*0.03);
        ctx.fillStyle=`hsla(${h},60%,60%,${al})`;
        ctx.beginPath();
        ctx.arc(gx+dxt, gy+dyt, distort>3 ? 1.4 : 0.7, 0, Math.PI*2);
        ctx.fill();
      }
    }

    // Gravity wells
    for(const w of this.wells){
      if(w.fade<0.01) continue;
      const r = 8 + (w.mass/2400)*32;
      const gr=ctx.createRadialGradient(w.x,w.y,0,w.x,w.y,r*4.5);
      gr.addColorStop(0, `rgba(255,100,40,${0.9*w.fade})`);
      gr.addColorStop(0.25,`rgba(200,60,255,${0.45*w.fade})`);
      gr.addColorStop(0.65,`rgba(200,60,255,${0.07*w.fade})`);
      gr.addColorStop(1,'rgba(0,0,0,0)');
      ctx.beginPath(); ctx.arc(w.x,w.y,r*4.5,0,Math.PI*2);
      ctx.fillStyle=gr; ctx.fill();
      ctx.beginPath(); ctx.arc(w.x,w.y,r,0,Math.PI*2);
      ctx.fillStyle=`rgba(12,4,28,${w.fade})`; ctx.fill();
      ctx.strokeStyle=`rgba(255,120,50,${0.75*w.fade})`;
      ctx.lineWidth=1.5; ctx.stroke();
      if(w.fade>0.45){
        ctx.textAlign='center';
        ctx.font=`700 8px 'Space Mono',monospace`;
        ctx.fillStyle=`rgba(255,150,80,${w.fade*0.85})`;
        ctx.fillText(uiText[pageLang].massLabel, w.x, w.y+r+15);
        ctx.font=`7px 'Space Mono',monospace`;
        ctx.fillStyle=`rgba(200,60,255,${w.fade*0.65})`;
        ctx.fillText(uiText[pageLang].interactionDown, w.x, w.y+r+26);
      }
    }

    // Draw bonds with traveling signals
    for(const bond of this.bonds){
      const a = this.pts[bond.i];
      const b = this.pts[bond.j];
      const mx=(a.x+b.x)/2, my=(a.y+b.y)/2;
      const bondTF = this.getFieldTF(mx,my);

      // Bond line — color and opacity by tf
      // blue (fast) → dim orange (slow)
      const hue = 210 - (1-bondTF)*150;
      const lineAlpha = 0.08 + bondTF*0.22; // slow bonds are dimmer
      ctx.strokeStyle=`hsla(${hue},65%,60%,${lineAlpha})`;
      ctx.lineWidth = 0.8 + (1-bondTF)*0.8;
      ctx.beginPath(); ctx.moveTo(a.x,a.y); ctx.lineTo(b.x,b.y); ctx.stroke();

      // Traveling signals (the interaction pulses)
      for(const sig of bond.signals){
        const sx = a.x + (b.x-a.x)*sig.t;
        const sy = a.y + (b.y-a.y)*sig.t;
        const sigTF = this.getFieldTF(sx,sy);
        const sigHue = 210 - (1-sigTF)*150;
        const sigR = 1.8 + (1-sigTF)*2.0;  // small — max ~4px even when slow
        const sigAlpha = 0.6 + sigTF*0.35;

        // tight glow — only 2× the dot radius
        const gr=ctx.createRadialGradient(sx,sy,0,sx,sy,sigR*2.2);
        gr.addColorStop(0, `hsla(${sigHue},90%,88%,${sigAlpha})`);
        gr.addColorStop(0.5,`hsla(${sigHue},75%,65%,${sigAlpha*0.35})`);
        gr.addColorStop(1,'rgba(0,0,0,0)');
        ctx.beginPath(); ctx.arc(sx,sy,sigR*2.2,0,Math.PI*2);
        ctx.fillStyle=gr; ctx.fill();

        // dot core
        ctx.beginPath(); ctx.arc(sx,sy,sigR*0.65,0,Math.PI*2);
        ctx.fillStyle=`hsla(${sigHue},95%,92%,${sigAlpha})`;
        ctx.fill();
      }
    }

    // Particles
    for(const p of this.pts){
      const tf=p.tf;
      const hue = 210 - (1-tf)*155;
      const r = p.r * (0.85 + (1-tf)*0.5);

      // ambient glow — tight, only when slowed
      if(tf < 0.75){
        const gl=(1-tf)*0.45;
        const gr=ctx.createRadialGradient(p.x,p.y,0,p.x,p.y,r*3.5);
        gr.addColorStop(0,`hsla(${hue},85%,65%,${gl})`);
        gr.addColorStop(1,'rgba(0,0,0,0)');
        ctx.beginPath(); ctx.arc(p.x,p.y,r*3.5,0,Math.PI*2);
        ctx.fillStyle=gr; ctx.fill();
      }

      // body
      ctx.beginPath(); ctx.arc(p.x,p.y,r,0,Math.PI*2);
      ctx.fillStyle=`hsla(${hue},70%,${55+tf*20}%,${0.65+tf*0.35})`;
      ctx.fill();

      // tf label only when very slow
      if(tf < 0.4){
        ctx.font=`6px 'Space Mono',monospace`;
        ctx.textAlign='center';
        ctx.fillStyle=`rgba(255,175,80,${(0.4-tf)*2.8})`;
        ctx.fillText(`×${tf.toFixed(2)}`,p.x,p.y-r-3);
      }
    }

    // Legend
    ctx.textAlign='left'; ctx.font='8px Space Mono,monospace';
    ctx.fillStyle='rgba(100,170,255,0.65)'; ctx.fillText(uiText[pageLang].simFast,12,18);
    ctx.fillStyle='rgba(255,130,50,0.65)';  ctx.fillText(uiText[pageLang].simSlow,12,30);
    ctx.fillStyle='rgba(200,60,255,0.5)';   ctx.fillText(uiText[pageLang].simAdd,12,42);
  }

  start(){
    if(this.running) return;
    this.running=true;
    const loop=()=>{ if(!this.running)return; this.update(); this.draw(); this.raf=requestAnimationFrame(loop); };
    loop();
  }
  stop(){ this.running=false; if(this.raf)cancelAnimationFrame(this.raf); }
  reset(){ this.wells=[]; this.init(); }
}

let philoSim=null;

function initPhiloSim(){
  const c=document.getElementById('particleCanvas');
  if(!c) return;
  if(philoSim){ philoSim.stop(); }
  philoSim=new ParticleSim(c);
  philoSim.start();
}

// Current active model on slide 3: 'a' = external wells, 'b' = density
let philoModel = 'a';

function switchPhiloModel(m) {
  philoModel = m;
  const wA = document.getElementById('canvasWrapA');
  const wB = document.getElementById('canvasWrapB');
  const bA = document.getElementById('btnModelA');
  const bB = document.getElementById('btnModelB');
  if (!wA || !wB) return;

  if (m === 'a') {
    wA.style.display = 'block'; wB.style.display = 'none';
    bA.style.background = 'rgba(196,75,255,0.18)'; bA.style.color = '#c44bff';
    bB.style.background = 'transparent'; bB.style.color = 'rgba(255,255,255,0.25)';
    if (densitySim) densitySim.stop();
    if (!philoSim || !philoSim.running) setTimeout(initPhiloSim, 50);
  } else {
    wA.style.display = 'none'; wB.style.display = 'block';
    bB.style.background = 'rgba(255,107,53,0.18)'; bB.style.color = '#ff6b35';
    bA.style.background = 'transparent'; bA.style.color = 'rgba(255,255,255,0.25)';
    if (philoSim) philoSim.stop();
    setTimeout(initDensitySim, 50);
  }
}


// ══════════════════════════════════════════════
// DENSITY SIMULATION — particles ARE the mass
// Local density → local time dilation
// ══════════════════════════════════════════════
class DensitySim {
  constructor(canvas) {
    this.c = canvas;
    this.x = canvas.getContext('2d');
    this.W = canvas.width;
    this.H = canvas.height;
    this.pts = [];
    this.bonds = [];
    this.running = false;
    this.raf = null;
    this.RADIUS = 72;      // influence radius for density calc
    this.MAX_BOND = 44;    // max bond distance
    this.init();
    this.bind();
  }

  init() {
    this.pts = [];
    // Uniform starting grid — 12×10
    const cols=12, rows=10, padX=28, padY=28;
    const sx=(this.W-padX*2)/(cols-1), sy=(this.H-padY*2)/(rows-1);
    for(let r=0;r<rows;r++){
      for(let c=0;c<cols;c++){
        this.pts.push({
          x: padX+c*sx+(Math.random()-.5)*sx*0.25,
          y: padY+r*sy+(Math.random()-.5)*sy*0.25,
          vx:(Math.random()-.5)*0.10,
          vy:(Math.random()-.5)*0.10,
          r: 1.6+Math.random()*0.6,
          tf: 1,
          density: 0,
          added: false   // was this particle user-added?
        });
      }
    }
    this.bonds = [];
  }

  bind() {
    const c=this.c;
    this.mode='add'; // 'add' | 'remove'
    const pos=e=>{
      const rc=c.getBoundingClientRect();
      const src=e.touches?e.touches[0]:e;
      return {
        x:(src.clientX-rc.left)*(this.W/rc.width),
        y:(src.clientY-rc.top)*(this.H/rc.height)
      };
    };
    const act=p=>{ this.mode==='add' ? this.spawnCluster(p) : this.removeCluster(p); };
    c.addEventListener('mousedown',e=>act(pos(e)));
    c.addEventListener('touchstart',e=>{e.preventDefault();act(pos(e));},{passive:false});
    // right-click = remove regardless of mode
    c.addEventListener('contextmenu',e=>{e.preventDefault();this.removeCluster(pos(e));});
  }

  setMode(m){ this.mode=m; }

  spawnCluster(p) {
    for(let i=0;i<8;i++){
      const a=Math.random()*Math.PI*2;
      const d=Math.random()*18;
      this.pts.push({
        x: p.x+Math.cos(a)*d,
        y: p.y+Math.sin(a)*d,
        vx:(Math.random()-.5)*0.15,
        vy:(Math.random()-.5)*0.15,
        r: 1.6+Math.random()*0.7,
        tf:1, density:0, added:true
      });
    }
  }

  removeCluster(p) {
    // Remove up to 10 closest particles within 50px, prefer added ones first
    const RADIUS = 50;
    const candidates = this.pts
      .map((pt,i) => ({i, d: Math.hypot(pt.x-p.x, pt.y-p.y), added: pt.added}))
      .filter(e => e.d < RADIUS)
      .sort((a,b) => (b.added - a.added) || (a.d - b.d)) // added first, then by distance
      .slice(0, 10);
    const toRemove = new Set(candidates.map(e => e.i));
    // Keep minimum 40 particles so grid doesn't empty out
    if(this.pts.length - toRemove.size < 40) {
      // only remove as many as we can
      let keep = this.pts.length - 40;
      const arr = [...toRemove];
      while(arr.length > keep) arr.pop();
      this.pts = this.pts.filter((_,i) => !new Set(arr).has(i));
    } else {
      this.pts = this.pts.filter((_,i) => !toRemove.has(i));
    }
    // bonds will rebuild next frame automatically
  }

  computeDensities() {
    const R=this.RADIUS, R2=R*R;
    for(const p of this.pts){
      let d=0;
      for(const q of this.pts){
        if(q===p) continue;
        const dx=p.x-q.x, dy=p.y-q.y;
        const dist2=dx*dx+dy*dy;
        if(dist2<R2){
          // gaussian kernel
          d += Math.exp(-dist2/(2*(R*0.4)*(R*0.4)));
        }
      }
      p.density = d;
      // tf: high density → slow time. Tuned so density~8 gives tf~0.2
      p.tf = Math.max(0.06, 1/(1+d*0.18));
    }
  }

  rebuildBonds() {
    const MD=this.MAX_BOND;
    const existing=new Map();
    for(const b of this.bonds) existing.set(`${b.i}_${b.j}`,b);
    const nb=[];
    for(let i=0;i<this.pts.length;i++){
      const a=this.pts[i];
      for(let j=i+1;j<this.pts.length;j++){
        const b=this.pts[j];
        if(Math.hypot(a.x-b.x,a.y-b.y)<MD){
          const key=`${i}_${j}`;
          nb.push(existing.has(key)
            ? existing.get(key)
            : {i,j,signals:[],nextSignal:10+Math.random()*40});
        }
      }
    }
    this.bonds=nb;
  }

  update() {
    this.computeDensities();
    this.rebuildBonds();

    for(const p of this.pts){
      const tf=p.tf;
      // gentle drift, scaled by tf
      p.x+=p.vx*tf; p.y+=p.vy*tf;
      // soft bounce walls
      if(p.x<8||p.x>this.W-8) p.vx*=-1;
      if(p.y<8||p.y>this.H-8) p.vy*=-1;
      p.x=Math.max(6,Math.min(this.W-6,p.x));
      p.y=Math.max(6,Math.min(this.H-6,p.y));
    }

    // Bond signals
    for(const bond of this.bonds){
      const a=this.pts[bond.i], b=this.pts[bond.j];
      const mx=(a.x+b.x)/2, my=(a.y+b.y)/2;
      // find tf at midpoint via nearest particle
      let minD=Infinity, bondTF=1;
      for(const p of this.pts){
        const d=Math.hypot(p.x-mx,p.y-my);
        if(d<minD){minD=d; bondTF=p.tf;}
      }
      bond.nextSignal-=bondTF;
      if(bond.nextSignal<=0){
        bond.signals.push({t:0,dir:Math.random()<.5?1:-1});
        bond.nextSignal=30+Math.random()*55;
      }
      for(let s=bond.signals.length-1;s>=0;s--){
        const sig=bond.signals[s];
        // tf at signal position
        const sx2=a.x+(b.x-a.x)*sig.t, sy2=a.y+(b.y-a.y)*sig.t;
        let md2=Infinity,sTF=1;
        for(const p of this.pts){
          const d=Math.hypot(p.x-sx2,p.y-sy2);
          if(d<md2){md2=d;sTF=p.tf;}
        }
        sig.t+=sig.dir*sTF*0.024;
        if(sig.t>1||sig.t<0) bond.signals.splice(s,1);
      }
    }
  }

  draw() {
    const ctx=this.x, W=this.W, H=this.H;
    ctx.clearRect(0,0,W,H);
    ctx.fillStyle='rgba(5,3,18,1)';
    ctx.fillRect(0,0,W,H);

    // Density heatmap — draw soft blobs under everything
    for(const p of this.pts){
      if(p.density < 0.5) continue;
      const intensity=Math.min(1,(p.density-0.5)/8);
      const r=22+intensity*20;
      const gr=ctx.createRadialGradient(p.x,p.y,0,p.x,p.y,r);
      // blue=sparse, orange=dense
      const hue=220-(1-p.tf)*170;
      gr.addColorStop(0,`hsla(${hue},70%,50%,${intensity*0.12})`);
      gr.addColorStop(1,'rgba(0,0,0,0)');
      ctx.beginPath(); ctx.arc(p.x,p.y,r,0,Math.PI*2);
      ctx.fillStyle=gr; ctx.fill();
    }

    // Bonds
    for(const bond of this.bonds){
      const a=this.pts[bond.i], b=this.pts[bond.j];
      const avgTF=(a.tf+b.tf)/2;
      const hue=210-(1-avgTF)*150;
      ctx.strokeStyle=`hsla(${hue},65%,58%,${0.06+avgTF*0.2})`;
      ctx.lineWidth=0.7+(1-avgTF)*0.5;
      ctx.beginPath(); ctx.moveTo(a.x,a.y); ctx.lineTo(b.x,b.y); ctx.stroke();

      // Signals
      for(const sig of bond.signals){
        const sx=a.x+(b.x-a.x)*sig.t;
        const sy=a.y+(b.y-a.y)*sig.t;
        let md=Infinity,sTF=1;
        for(const p of this.pts){
          const d=Math.hypot(p.x-sx,p.y-sy);
          if(d<md){md=d;sTF=p.tf;}
        }
        const sh=210-(1-sTF)*150;
        const sr=1.6+(1-sTF)*1.8;
        const gr2=ctx.createRadialGradient(sx,sy,0,sx,sy,sr*2.5);
        gr2.addColorStop(0,`hsla(${sh},90%,88%,${0.55+sTF*0.4})`);
        gr2.addColorStop(1,'rgba(0,0,0,0)');
        ctx.beginPath(); ctx.arc(sx,sy,sr*2.5,0,Math.PI*2);
        ctx.fillStyle=gr2; ctx.fill();
        ctx.beginPath(); ctx.arc(sx,sy,sr*0.6,0,Math.PI*2);
        ctx.fillStyle=`hsla(${sh},95%,92%,0.9)`;
        ctx.fill();
      }
    }

    // Particles
    for(const p of this.pts){
      const hue=210-(1-p.tf)*155;
      const r=p.r*(0.85+(1-p.tf)*0.5);
      // glow when slow
      if(p.tf<0.75){
        const gr=ctx.createRadialGradient(p.x,p.y,0,p.x,p.y,r*3.5);
        gr.addColorStop(0,`hsla(${hue},85%,65%,${(1-p.tf)*0.42})`);
        gr.addColorStop(1,'rgba(0,0,0,0)');
        ctx.beginPath(); ctx.arc(p.x,p.y,r*3.5,0,Math.PI*2);
        ctx.fillStyle=gr; ctx.fill();
      }
      ctx.beginPath(); ctx.arc(p.x,p.y,r,0,Math.PI*2);
      // added particles slightly brighter
      ctx.fillStyle=p.added
        ? `hsla(${hue},85%,${65+p.tf*20}%,0.95)`
        : `hsla(${hue},65%,${52+p.tf*22}%,${0.6+p.tf*0.35})`;
      ctx.fill();
      // tf label
      if(p.tf<0.38){
        ctx.font=`6px 'Space Mono',monospace`;
        ctx.textAlign='center';
        ctx.fillStyle=`rgba(255,175,80,${(0.38-p.tf)*3})`;
        ctx.fillText(`×${p.tf.toFixed(2)}`,p.x,p.y-r-3);
      }
    }

    // Particle count
    ctx.textAlign='left'; ctx.font='8px Space Mono,monospace';
    ctx.fillStyle='rgba(100,170,255,0.65)'; ctx.fillText(uiText[pageLang].simSparse,12,18);
    ctx.fillStyle='rgba(255,130,50,0.65)';  ctx.fillText(uiText[pageLang].simDense,12,30);
    ctx.fillStyle='rgba(200,60,255,0.5)';   ctx.fillText(`${uiText[pageLang].simAddWithCount}  [${this.pts.length} ${uiText[pageLang].particles}]`,12,42);
  }

  start(){
    if(this.running)return;
    this.running=true;
    const loop=()=>{if(!this.running)return;this.update();this.draw();this.raf=requestAnimationFrame(loop);};
    loop();
  }
  stop(){this.running=false;if(this.raf)cancelAnimationFrame(this.raf);}
}

let densitySim=null;

function toggleDensityMode(){
  const btn=document.getElementById('densityModeBtn');
  if(!densitySim||!btn) return;
  if(densitySim.mode==='add'){
    densitySim.setMode('remove');
    btn.textContent=uiText[pageLang].densityRemove;
    btn.style.borderColor='rgba(91,180,255,0.55)';
    btn.style.color='#5bb4ff';
  } else {
    densitySim.setMode('add');
    btn.textContent=uiText[pageLang].densityAdd;
    btn.style.borderColor='rgba(255,107,53,0.45)';
    btn.style.color='#ff6b35';
  }
}

function initDensitySim(){
  const c=document.getElementById('densityCanvas');
  if(!c)return;
  if(densitySim){densitySim.stop();}
  densitySim=new DensitySim(c);
  densitySim.start();
  // reset button to add mode
  const btn=document.getElementById('densityModeBtn');
  if(btn){ btn.textContent=uiText[pageLang].densityAdd; btn.style.borderColor='rgba(255,107,53,0.45)'; btn.style.color='#ff6b35'; }
}

// ══════════════════════════════════════════════

function onEnter(i){
 setSlidePhoto(i);
 if(i===2){
  ['ai1','ai2','ai3','ai4'].forEach((id,j)=>{ const el=document.getElementById(id); if(el){ el.classList.remove('vis'); setTimeout(()=>el.classList.add('vis'),150+j*160); } });
 }
 if(i===PHILO_SLIDE){
   // always reset to model A when entering slide
   philoModel='a';
   switchPhiloModel('a');
 } else {
   if(philoSim) philoSim.stop();
   if(densitySim) densitySim.stop();
 }
}

document.addEventListener('keydown',e=>{ if(e.key==='ArrowRight'||e.key==='ArrowDown') go(1); if(e.key==='ArrowLeft'||e.key==='ArrowUp') go(-1); });
let tx=0; document.addEventListener('touchstart',e=>tx=e.touches[0].clientX); document.addEventListener('touchend',e=>{ const dx=e.changedTouches[0].clientX-tx; if(Math.abs(dx)>50) go(dx<0?1:-1); });

buildDots(); updNav();
</script>
</body>
</html>
